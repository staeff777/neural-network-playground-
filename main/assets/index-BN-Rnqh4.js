(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const o of l)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(l){const o={};return l.integrity&&(o.integrity=l.integrity),l.referrerPolicy&&(o.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?o.credentials="include":l.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(l){if(l.ep)return;l.ep=!0;const o=n(l);fetch(l.href,o)}})();var Mt,I,te,ut,It,ee,ne,ie,Lt,Wt,Ct,gt={},oe=[],pe=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,kt=Array.isArray;function st(e,t){for(var n in t)e[n]=t[n];return e}function $t(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function me(e,t,n){var i,l,o,s={};for(o in t)o=="key"?i=t[o]:o=="ref"?l=t[o]:s[o]=t[o];if(arguments.length>2&&(s.children=arguments.length>3?Mt.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(o in e.defaultProps)s[o]===void 0&&(s[o]=e.defaultProps[o]);return bt(e,s,i,l,null)}function bt(e,t,n,i,l){var o={type:e,props:t,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:l??++te,__i:-1,__u:0};return l==null&&I.vnode!=null&&I.vnode(o),o}function dt(e){return e.children}function vt(e,t){this.props=e,this.context=t}function pt(e,t){if(t==null)return e.__?pt(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?pt(e):null}function se(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return se(e)}}function Ht(e){(!e.__d&&(e.__d=!0)&&ut.push(e)&&!St.__r++||It!=I.debounceRendering)&&((It=I.debounceRendering)||ee)(St)}function St(){for(var e,t,n,i,l,o,s,a=1;ut.length;)ut.length>a&&ut.sort(ne),e=ut.shift(),a=ut.length,e.__d&&(n=void 0,i=void 0,l=(i=(t=e).__v).__e,o=[],s=[],t.__P&&((n=st({},i)).__v=i.__v+1,I.vnode&&I.vnode(n),zt(t.__P,n,i,t.__n,t.__P.namespaceURI,32&i.__u?[l]:null,o,l??pt(i),!!(32&i.__u),s),n.__v=i.__v,n.__.__k[n.__i]=n,ae(o,n,s),i.__e=i.__=null,n.__e!=l&&se(n)));St.__r=0}function re(e,t,n,i,l,o,s,a,u,h,g){var c,b,d,S,T,v,p,x=i&&i.__k||oe,P=t.length;for(u=ge(n,t,x,u,P),c=0;c<P;c++)(d=n.__k[c])!=null&&(b=d.__i==-1?gt:x[d.__i]||gt,d.__i=c,v=zt(e,d,b,l,o,s,a,u,h,g),S=d.__e,d.ref&&b.ref!=d.ref&&(b.ref&&Nt(b.ref,null,d),g.push(d.ref,d.__c||S,d)),T==null&&S!=null&&(T=S),(p=!!(4&d.__u))||b.__k===d.__k?u=le(d,u,e,p):typeof d.type=="function"&&v!==void 0?u=v:S&&(u=S.nextSibling),d.__u&=-7);return n.__e=T,u}function ge(e,t,n,i,l){var o,s,a,u,h,g=n.length,c=g,b=0;for(e.__k=new Array(l),o=0;o<l;o++)(s=t[o])!=null&&typeof s!="boolean"&&typeof s!="function"?(typeof s=="string"||typeof s=="number"||typeof s=="bigint"||s.constructor==String?s=e.__k[o]=bt(null,s,null,null,null):kt(s)?s=e.__k[o]=bt(dt,{children:s},null,null,null):s.constructor==null&&s.__b>0?s=e.__k[o]=bt(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):e.__k[o]=s,u=o+b,s.__=e,s.__b=e.__b+1,a=null,(h=s.__i=xe(s,n,u,c))!=-1&&(c--,(a=n[h])&&(a.__u|=2)),a==null||a.__v==null?(h==-1&&(l>g?b--:l<g&&b++),typeof s.type!="function"&&(s.__u|=4)):h!=u&&(h==u-1?b--:h==u+1?b++:(h>u?b--:b++,s.__u|=4))):e.__k[o]=null;if(c)for(o=0;o<g;o++)(a=n[o])!=null&&(2&a.__u)==0&&(a.__e==i&&(i=pt(a)),he(a,a));return i}function le(e,t,n,i){var l,o;if(typeof e.type=="function"){for(l=e.__k,o=0;l&&o<l.length;o++)l[o]&&(l[o].__=e,t=le(l[o],t,n,i));return t}e.__e!=t&&(i&&(t&&e.type&&!t.parentNode&&(t=pt(e)),n.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function xe(e,t,n,i){var l,o,s,a=e.key,u=e.type,h=t[n],g=h!=null&&(2&h.__u)==0;if(h===null&&a==null||g&&a==h.key&&u==h.type)return n;if(i>(g?1:0)){for(l=n-1,o=n+1;l>=0||o<t.length;)if((h=t[s=l>=0?l--:o++])!=null&&(2&h.__u)==0&&a==h.key&&u==h.type)return s}return-1}function Dt(e,t,n){t[0]=="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||pe.test(t)?n:n+"px"}function yt(e,t,n,i,l){var o,s;t:if(t=="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof i=="string"&&(e.style.cssText=i=""),i)for(t in i)n&&t in n||Dt(e.style,t,"");if(n)for(t in n)i&&n[t]==i[t]||Dt(e.style,t,n[t])}else if(t[0]=="o"&&t[1]=="n")o=t!=(t=t.replace(ie,"$1")),s=t.toLowerCase(),t=s in e||t=="onFocusOut"||t=="onFocusIn"?s.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+o]=n,n?i?n.u=i.u:(n.u=Lt,e.addEventListener(t,o?Ct:Wt,o)):e.removeEventListener(t,o?Ct:Wt,o);else{if(l=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=n??"";break t}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&n==1?"":n))}}function Xt(e){return function(t){if(this.l){var n=this.l[t.type+e];if(t.t==null)t.t=Lt++;else if(t.t<n.u)return;return n(I.event?I.event(t):t)}}}function zt(e,t,n,i,l,o,s,a,u,h){var g,c,b,d,S,T,v,p,x,P,C,m,M,_,r,A,W,L=t.type;if(t.constructor!=null)return null;128&n.__u&&(u=!!(32&n.__u),o=[a=t.__e=n.__e]),(g=I.__b)&&g(t);t:if(typeof L=="function")try{if(p=t.props,x="prototype"in L&&L.prototype.render,P=(g=L.contextType)&&i[g.__c],C=g?P?P.props.value:g.__:i,n.__c?v=(c=t.__c=n.__c).__=c.__E:(x?t.__c=c=new L(p,C):(t.__c=c=new vt(p,C),c.constructor=L,c.render=be),P&&P.sub(c),c.state||(c.state={}),c.__n=i,b=c.__d=!0,c.__h=[],c._sb=[]),x&&c.__s==null&&(c.__s=c.state),x&&L.getDerivedStateFromProps!=null&&(c.__s==c.state&&(c.__s=st({},c.__s)),st(c.__s,L.getDerivedStateFromProps(p,c.__s))),d=c.props,S=c.state,c.__v=t,b)x&&L.getDerivedStateFromProps==null&&c.componentWillMount!=null&&c.componentWillMount(),x&&c.componentDidMount!=null&&c.__h.push(c.componentDidMount);else{if(x&&L.getDerivedStateFromProps==null&&p!==d&&c.componentWillReceiveProps!=null&&c.componentWillReceiveProps(p,C),t.__v==n.__v||!c.__e&&c.shouldComponentUpdate!=null&&c.shouldComponentUpdate(p,c.__s,C)===!1){for(t.__v!=n.__v&&(c.props=p,c.state=c.__s,c.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function(k){k&&(k.__=t)}),m=0;m<c._sb.length;m++)c.__h.push(c._sb[m]);c._sb=[],c.__h.length&&s.push(c);break t}c.componentWillUpdate!=null&&c.componentWillUpdate(p,c.__s,C),x&&c.componentDidUpdate!=null&&c.__h.push(function(){c.componentDidUpdate(d,S,T)})}if(c.context=C,c.props=p,c.__P=e,c.__e=!1,M=I.__r,_=0,x){for(c.state=c.__s,c.__d=!1,M&&M(t),g=c.render(c.props,c.state,c.context),r=0;r<c._sb.length;r++)c.__h.push(c._sb[r]);c._sb=[]}else do c.__d=!1,M&&M(t),g=c.render(c.props,c.state,c.context),c.state=c.__s;while(c.__d&&++_<25);c.state=c.__s,c.getChildContext!=null&&(i=st(st({},i),c.getChildContext())),x&&!b&&c.getSnapshotBeforeUpdate!=null&&(T=c.getSnapshotBeforeUpdate(d,S)),A=g,g!=null&&g.type===dt&&g.key==null&&(A=ce(g.props.children)),a=re(e,kt(A)?A:[A],t,n,i,l,o,s,a,u,h),c.base=t.__e,t.__u&=-161,c.__h.length&&s.push(c),v&&(c.__E=c.__=null)}catch(k){if(t.__v=null,u||o!=null)if(k.then){for(t.__u|=u?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;o[o.indexOf(a)]=null,t.__e=a}else{for(W=o.length;W--;)$t(o[W]);Rt(t)}else t.__e=n.__e,t.__k=n.__k,k.then||Rt(t);I.__e(k,t,n)}else o==null&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):a=t.__e=ye(n.__e,t,n,i,l,o,s,u,h);return(g=I.diffed)&&g(t),128&t.__u?void 0:a}function Rt(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(Rt)}function ae(e,t,n){for(var i=0;i<n.length;i++)Nt(n[i],n[++i],n[++i]);I.__c&&I.__c(t,e),e.some(function(l){try{e=l.__h,l.__h=[],e.some(function(o){o.call(l)})}catch(o){I.__e(o,l.__v)}})}function ce(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:kt(e)?e.map(ce):st({},e)}function ye(e,t,n,i,l,o,s,a,u){var h,g,c,b,d,S,T,v=n.props||gt,p=t.props,x=t.type;if(x=="svg"?l="http://www.w3.org/2000/svg":x=="math"?l="http://www.w3.org/1998/Math/MathML":l||(l="http://www.w3.org/1999/xhtml"),o!=null){for(h=0;h<o.length;h++)if((d=o[h])&&"setAttribute"in d==!!x&&(x?d.localName==x:d.nodeType==3)){e=d,o[h]=null;break}}if(e==null){if(x==null)return document.createTextNode(p);e=document.createElementNS(l,x,p.is&&p),a&&(I.__m&&I.__m(t,o),a=!1),o=null}if(x==null)v===p||a&&e.data==p||(e.data=p);else{if(o=o&&Mt.call(e.childNodes),!a&&o!=null)for(v={},h=0;h<e.attributes.length;h++)v[(d=e.attributes[h]).name]=d.value;for(h in v)if(d=v[h],h!="children"){if(h=="dangerouslySetInnerHTML")c=d;else if(!(h in p)){if(h=="value"&&"defaultValue"in p||h=="checked"&&"defaultChecked"in p)continue;yt(e,h,null,d,l)}}for(h in p)d=p[h],h=="children"?b=d:h=="dangerouslySetInnerHTML"?g=d:h=="value"?S=d:h=="checked"?T=d:a&&typeof d!="function"||v[h]===d||yt(e,h,d,v[h],l);if(g)a||c&&(g.__html==c.__html||g.__html==e.innerHTML)||(e.innerHTML=g.__html),t.__k=[];else if(c&&(e.innerHTML=""),re(t.type=="template"?e.content:e,kt(b)?b:[b],t,n,i,x=="foreignObject"?"http://www.w3.org/1999/xhtml":l,o,s,o?o[0]:n.__k&&pt(n,0),a,u),o!=null)for(h=o.length;h--;)$t(o[h]);a||(h="value",x=="progress"&&S==null?e.removeAttribute("value"):S!=null&&(S!==e[h]||x=="progress"&&!S||x=="option"&&S!=v[h])&&yt(e,h,S,v[h],l),h="checked",T!=null&&T!=e[h]&&yt(e,h,T,v[h],l))}return e}function Nt(e,t,n){try{if(typeof e=="function"){var i=typeof e.__u=="function";i&&e.__u(),i&&t==null||(e.__u=e(t))}else e.current=t}catch(l){I.__e(l,n)}}function he(e,t,n){var i,l;if(I.unmount&&I.unmount(e),(i=e.ref)&&(i.current&&i.current!=e.__e||Nt(i,null,t)),(i=e.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(o){I.__e(o,t)}i.base=i.__P=null}if(i=e.__k)for(l=0;l<i.length;l++)i[l]&&he(i[l],t,n||typeof e.type!="function");n||$t(e.__e),e.__c=e.__=e.__e=void 0}function be(e,t,n){return this.constructor(e,n)}function ve(e,t,n){var i,l,o,s;t==document&&(t=document.documentElement),I.__&&I.__(e,t),l=(i=!1)?null:t.__k,o=[],s=[],zt(t,e=t.__k=me(dt,null,[e]),l||gt,gt,t.namespaceURI,l?null:t.firstChild?Mt.call(t.childNodes):null,o,l?l.__e:t.firstChild,i,s),ae(o,e,s)}Mt=oe.slice,I={__e:function(e,t,n,i){for(var l,o,s;t=t.__;)if((l=t.__c)&&!l.__)try{if((o=l.constructor)&&o.getDerivedStateFromError!=null&&(l.setState(o.getDerivedStateFromError(e)),s=l.__d),l.componentDidCatch!=null&&(l.componentDidCatch(e,i||{}),s=l.__d),s)return l.__E=l}catch(a){e=a}throw e}},te=0,vt.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=st({},this.state),typeof e=="function"&&(e=e(st({},n),this.props)),e&&st(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),Ht(this))},vt.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),Ht(this))},vt.prototype.render=dt,ut=[],ee=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ne=function(e,t){return e.__v.__b-t.__v.__b},St.__r=0,ie=/(PointerCapture)$|Capture$/i,Lt=0,Wt=Xt(!1),Ct=Xt(!0);var we=0;function f(e,t,n,i,l,o){t||(t={});var s,a,u=t;if("ref"in u)for(a in u={},t)a=="ref"?s=t[a]:u[a]=t[a];var h={type:e,props:u,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--we,__i:-1,__u:0,__source:l,__self:o};if(typeof e=="function"&&(s=e.defaultProps))for(a in s)u[a]===void 0&&(u[a]=s[a]);return I.vnode&&I.vnode(h),h}var xt,G,At,Bt,Tt=0,fe=[],V=I,Gt=V.__b,Yt=V.__r,Vt=V.diffed,Ut=V.__c,Ot=V.unmount,jt=V.__;function Ft(e,t){V.__h&&V.__h(G,e,Tt||t),Tt=0;var n=G.__H||(G.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function Q(e){return Tt=1,Se(de,e)}function Se(e,t,n){var i=Ft(xt++,2);if(i.t=e,!i.__c&&(i.__=[de(void 0,t),function(a){var u=i.__N?i.__N[0]:i.__[0],h=i.t(u,a);u!==h&&(i.__N=[h,i.__[1]],i.__c.setState({}))}],i.__c=G,!G.__f)){var l=function(a,u,h){if(!i.__c.__H)return!0;var g=i.__c.__H.__.filter(function(b){return!!b.__c});if(g.every(function(b){return!b.__N}))return!o||o.call(this,a,u,h);var c=i.__c.props!==a;return g.forEach(function(b){if(b.__N){var d=b.__[0];b.__=b.__N,b.__N=void 0,d!==b.__[0]&&(c=!0)}}),o&&o.call(this,a,u,h)||c};G.__f=!0;var o=G.shouldComponentUpdate,s=G.componentWillUpdate;G.componentWillUpdate=function(a,u,h){if(this.__e){var g=o;o=void 0,l(a,u,h),o=g}s&&s.call(this,a,u,h)},G.shouldComponentUpdate=l}return i.__N||i.__}function mt(e,t){var n=Ft(xt++,3);!V.__s&&ue(n.__H,t)&&(n.__=e,n.u=t,G.__H.__h.push(n))}function rt(e){return Tt=5,Te(function(){return{current:e}},[])}function Te(e,t){var n=Ft(xt++,7);return ue(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function Me(){for(var e;e=fe.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(wt),e.__H.__h.forEach(Et),e.__H.__h=[]}catch(t){e.__H.__h=[],V.__e(t,e.__v)}}V.__b=function(e){G=null,Gt&&Gt(e)},V.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),jt&&jt(e,t)},V.__r=function(e){Yt&&Yt(e),xt=0;var t=(G=e.__c).__H;t&&(At===G?(t.__h=[],G.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(t.__h.forEach(wt),t.__h.forEach(Et),t.__h=[],xt=0)),At=G},V.diffed=function(e){Vt&&Vt(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(fe.push(t)!==1&&Bt===V.requestAnimationFrame||((Bt=V.requestAnimationFrame)||ke)(Me)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),At=G=null},V.__c=function(e,t){t.some(function(n){try{n.__h.forEach(wt),n.__h=n.__h.filter(function(i){return!i.__||Et(i)})}catch(i){t.some(function(l){l.__h&&(l.__h=[])}),t=[],V.__e(i,n.__v)}}),Ut&&Ut(e,t)},V.unmount=function(e){Ot&&Ot(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(i){try{wt(i)}catch(l){t=l}}),n.__H=void 0,t&&V.__e(t,n.__v))};var Zt=typeof requestAnimationFrame=="function";function ke(e){var t,n=function(){clearTimeout(i),Zt&&cancelAnimationFrame(t),setTimeout(e)},i=setTimeout(n,35);Zt&&(t=requestAnimationFrame(n))}function wt(e){var t=G,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),G=t}function Et(e){var t=G;e.__c=e.__(),G=t}function ue(e,t){return!e||e.length!==t.length||t.some(function(n,i){return n!==e[i]})}function de(e,t){return typeof t=="function"?t(e):t}class Ae{constructor(t){this.model=t}train(t,n,i){if(i!==void 0)return this.trainLegacy(t,n,i);const l=n,o=[];let s=1/0,a={};const u=g=>{const c=[];if(g.step<=0)return[g.min];for(let b=g.min;b<=g.max+1e-4;b+=g.step)c.push(parseFloat(b.toFixed(2)));return c},h=(g,c)=>{if(console.log({paramIndex:g,currentParams:c}),g===l.length){const S=[];let T=0;c.forEach((C,m)=>{l[m].name.toLowerCase().includes("bias")?T=C:S.push(C)}),this.model.setWeights?this.model.setWeights(S):this.model.setWeight&&this.model.setWeight(S[0]),this.model.setBias(T);let v=0,p=0;for(const C of t){const m=this.model.predict(C.input),M=C.target-m;v+=M*M,p+=Math.abs(M)}const x=v/t.length,P=p/t.length;x<s&&(s=x,a={weights:[...S],bias:T}),o.push({params:[...c],error:x,mae:P});return}const b=l[g],d=u(b);for(const S of d)c[g]=S,h(g+1,c)};return h(0,new Array(l.length)),{bestParams:a,history:o,minError:s}}trainLegacy(t,n,i){const l=[];let o=n.min,s=i.min,a=1/0;for(let u=n.min;u<=n.max;u+=n.step)for(let h=i.min;h<=i.max;h+=i.step){const g=parseFloat(u.toFixed(2)),c=parseFloat(h.toFixed(2));this.model.setWeight(g),this.model.setBias(c);let b=0,d=0;for(const v of t){const p=this.model.predict(v.input),x=v.target-p;b+=x*x,d+=Math.abs(x)}const S=b/t.length,T=d/t.length;S<a&&(a=S,o=g,s=c),l.push({weight:g,bias:c,error:S,mae:T})}return{bestWeight:o,bestBias:s,history:l}}async trainAsync(t,n,i){if(!Array.isArray(n)){const d=arguments[1],S=arguments[2],T=arguments[3];let v=d.min,p=S.min,x=1/0,P=[];const C=20;let m=0;for(let M=d.min;M<=d.max;M+=d.step)for(let _=S.min;_<=S.max;_+=S.step){const r=parseFloat(M.toFixed(2)),A=parseFloat(_.toFixed(2));this.model.setWeight(r),this.model.setBias(A);let W=0,L=0;for(const z of t){const w=this.model.predict(z.input),N=z.target-w;W+=N*N,L+=Math.abs(N)}const k=W/t.length,E=L/t.length;k<x&&(x=k,v=r,p=A);const y={weight:r,bias:A,error:k,mae:E};P.push(y),m++,m%C===0&&(T&&T(P,{bestWeight:v,bestBias:p,minError:x}),P=[],await new Promise(z=>setTimeout(z,0)))}return P.length>0&&T&&T(P,{bestWeight:v,bestBias:p,minError:x}),{bestWeight:v,bestBias:p,minError:x}}let o=1/0,s={},a=0;const u=50;let h=[];const g=d=>{const S=[];if(d.step<=0)return[d.min];for(let T=d.min;T<=d.max+1e-4;T+=d.step)S.push(parseFloat(T.toFixed(2)));return S},c=n.map(g),b=async(d,S)=>{if(d===n.length){const v=[];let p=0;S.forEach((_,r)=>{n[r].name.toLowerCase().includes("bias")?p=_:v.push(_)}),this.model.setWeights?this.model.setWeights(v):this.model.setWeight&&this.model.setWeight(v[0]),this.model.setBias(p);let x=0,P=0;for(const _ of t){const r=this.model.predict(_.input),A=_.target-r;x+=A*A,P+=Math.abs(A)}const C=x/t.length,m=P/t.length;C<o&&(o=C,s={weights:[...v],bias:p});const M={params:[...S],error:C,mae:m};h.push(M),a++,a%u===0&&(i&&i(h,{bestParams:s,minError:o}),h=[],await new Promise(_=>setTimeout(_,0)));return}const T=c[d];for(const v of T)S[d]=v,await b(d+1,S)};return await b(0,new Array(n.length)),h.length>0&&i&&i(h,{bestParams:s,minError:o}),{bestParams:s,minError:o}}async trainRandomAsync(t,n,i){let a=1/0,u={},h=n.map(p=>({min:p.min,max:p.max,span:p.max-p.min})),g=h.map(p=>p.min+Math.random()*p.span);const c=p=>{const x=[];let P=0;p.forEach((M,_)=>{n[_].name.toLowerCase().includes("bias")?P=M:x.push(M)}),this.model.setWeights?this.model.setWeights(x):this.model.setWeight&&this.model.setWeight(x[0]),this.model.setBias(P);let C=0,m=0;for(const M of t){const _=this.model.predict(M.input),r=M.target-_;C+=r*r,m+=Math.abs(r)}return{mse:C/t.length,mae:m/t.length,weights:x,bias:P}};let b=c(g);a=b.mse,u={weights:b.weights,bias:b.bias,_array:[...g]},i&&i([{params:[...g],error:a,mae:b.mae}],{bestParams:u,minError:a}),await new Promise(p=>setTimeout(p,0));let d=[];const S=10;let T=a,v=[...g];for(let p=0;p<1e4;p++){const P=p<9e3;let C,m;if(P){const k=p/9e3;C=.2*(1-k*.5),m=.5*(1-k*.5)}else C=.1*(1-(p-9e3)/999.9999999999998),m=.5*.5*Math.pow(.992,p-1e4*.9);let M=!1;const _=[...v];let r=!1;for(;!r;)_.forEach((k,E)=>{if(Math.random()<.4)return;r=!0;const y=h[E];let z=!1;if(P){const H=y.span*.15;k<y.min+H&&(y.min-=y.span*.8,y.span=y.max-y.min,z=!0),k>y.max-H&&(y.max+=y.span*.8,y.span=y.max-y.min,z=!0),z&&(M=!0)}let w=y.span*m;z&&(w=Math.max(w,y.span*.25));const N=w;let R=k+(Math.random()-.5)*2*N;R<y.min&&(R=y.min),R>y.max&&(R=y.max),_[E]=R});const A=c(_),W=A.mse-T;let L=!1;if(W<0)L=!0;else{const k=Math.exp(-W/(C+1e-9));Math.random()<k&&(L=!0)}if(L&&(v=_,T=A.mse),A.mse<a&&(a=A.mse,u={weights:A.weights,bias:A.bias,_array:[..._]}),d.push({params:[..._],error:A.mse,mae:A.mae}),d.length>=S){let k;M&&(k="Grenzen dynamisch erweitert..."),i&&i(d,{bestParams:u,minError:a,message:k}),d=[],await new Promise(E=>setTimeout(E,0))}}return d.length>0&&i&&i(d,{bestParams:u,minError:a}),{bestParams:u,minError:a}}}function Pe({history:e,currentStepIndex:t,isTraining:n,paramsConfig:i}){const l=rt(null);return mt(()=>{const o=l.current;if(!o||!e||e.length===0)return;const s=o.getContext("2d"),a=o.width,u=o.height;s.clearRect(0,0,a,u),s.fillStyle="#fff",s.fillRect(0,0,a,u);const h=Math.max(...e.map(x=>x.error)),c=!n&&e.length>0?e.length-1:t!==null&&t>=0?Math.min(t,e.length-1):-1;let b=-1,d=1/0;for(let x=0;x<=c;x++)e[x].error<d&&(d=e[x].error,b=x);let S=[];if(i){const x=i.length,P=x>=4?3:x,C=Math.ceil(x/P),m=a/P,M=u/C;S=i.map((_,r)=>{const A=e.map(y=>y.params[r]),W=Math.min(...A),L=Math.max(...A),k=r%P,E=Math.floor(r/P);return{xLabel:_.name,xMin:W,xMax:L,getValue:(y,z)=>y.params[r],offsetX:k*m,offsetY:E*M,w:m,h:M}})}else{const x=a/2,P=e.map(m=>m.weight),C=e.map(m=>m.bias);S=[{xLabel:"Weight",xMin:Math.min(...P),xMax:Math.max(...P),getValue:m=>m.weight,offsetX:0,offsetY:0,w:x,h:u},{xLabel:"Bias",xMin:Math.min(...C),xMax:Math.max(...C),getValue:m=>m.bias,offsetX:x,offsetY:0,w:x,h:u}]}const T=35;S.forEach(x=>{const{xLabel:P,xMin:C,xMax:m,getValue:M,offsetX:_,offsetY:r,w:A,h:W}=x,L=E=>r+W-T-E/(h||1)*(W-2*T),k=E=>_+T+(E-C)/(m-C||1)*(A-2*T);s.strokeStyle="#eee",s.strokeRect(_,r,A,W),s.beginPath(),s.strokeStyle="#333",s.lineWidth=1,s.moveTo(_+T,r+T),s.lineTo(_+T,r+W-T),s.lineTo(_+A-T,r+W-T),s.stroke(),s.fillStyle="#333",s.font="11px sans-serif",s.textAlign="center",s.fillText(P,_+A/2,r+W-10),_===0&&(s.save(),s.translate(_+10,r+W/2),s.rotate(-Math.PI/2),s.fillText("Error",0,0),s.restore()),s.fillStyle="#666",s.font="9px sans-serif",s.fillText(C.toFixed(1),_+T,r+W-T+12),s.fillText(m.toFixed(1),_+A-T,r+W-T+12),s.fillStyle="rgba(52, 152, 219, 0.4)";for(let E=0;E<=c;E++){const y=M(e[E],E),z=k(y),w=L(e[E].error);s.fillRect(z,w,2,2)}if(b>=0){const E=M(e[b],b),y=k(E),z=L(e[b].error);s.beginPath(),s.fillStyle="#2ecc71",s.strokeStyle="#27ae60",s.arc(y,z,6,0,Math.PI*2),s.fill(),s.stroke()}if(n&&t!==null&&t>=0&&t<=c){const E=M(e[t],t),y=k(E),z=L(e[t].error);s.beginPath(),s.fillStyle="#e74c3c",s.strokeStyle="#c0392b",s.arc(y,z,5,0,Math.PI*2),s.fill(),s.stroke()}});const v=a-120,p=10;s.fillStyle="rgba(255,255,255,0.8)",s.fillRect(v,p,110,50),s.strokeStyle="#ccc",s.strokeRect(v,p,110,50),s.textAlign="left",s.font="10px sans-serif",s.beginPath(),s.fillStyle="#e74c3c",s.arc(v+10,p+15,4,0,Math.PI*2),s.fill(),s.fillStyle="#333",s.fillText("Current Scan",v+20,p+18),s.beginPath(),s.fillStyle="#2ecc71",s.arc(v+10,p+35,4,0,Math.PI*2),s.fill(),s.fillStyle="#333",s.fillText("Best So Far",v+20,p+38),!n&&b>=0&&(s.fillStyle="#333",s.font="bold 12px sans-serif",s.textAlign="right",s.fillText(`Min Error: ${d.toFixed(5)}`,a-10,u-10))},[e,t,n,i]),f("div",{style:{border:"1px solid #ccc",borderRadius:"8px",padding:"10px",background:"#fff"},children:f("canvas",{ref:l,width:800,height:400,style:{width:"100%",height:"auto"}})})}function We({input:e,weight:t,bias:n,output:i,formula:l="y = w * x + b",inputLabel:o="Input",outputLabel:s="Output",biasLabel:a="b"}){const g=Array.isArray(e)?e:[e],c=Array.isArray(t)?t:[t],b=Array.isArray(o)?o:[o],d=Number(n)||0,S=Number(i)||0,T=g.length,v=100,p=80,x=v-(T-1)*p/2,P=50,C=Math.max(200,T*80+50);return f("div",{style:{border:"1px solid #ccc",borderRadius:"8px",padding:"10px",background:"#fff",textAlign:"center"},children:[f("h3",{children:"Modell Architektur"}),f("svg",{width:"350",height:C,style:{overflow:"visible"},children:[f("title",{children:"Network Visualization"}),f("defs",{children:f("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"28",refY:"3.5",orient:"auto",children:f("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#333"})})}),g.map((m,M)=>{const _=x+M*p,r=Number(c[M])||0,A=b[M]||`x${M+1}`,W=Number(m)||0;return f("g",{children:[f("line",{x1:P,y1:_,x2:300,y2:v,stroke:"#333",strokeWidth:"2",markerEnd:"url(#arrowhead)"}),f("g",{transform:`translate(${(P+300)/2-15}, ${(_+v)/2-10})`,children:[f("rect",{x:"-15",y:"-10",width:"40",height:"20",fill:"#fff",rx:"4",stroke:"#ccc"}),f("text",{x:"5",y:"5",textAnchor:"middle",fill:"#e74c3c",fontSize:"11",fontWeight:"bold",children:r.toFixed(1)})]}),f("circle",{cx:P,cy:_,r:30,fill:"#fff",stroke:"#333",strokeWidth:"2"}),f("text",{x:P,y:_,textAnchor:"middle",dominantBaseline:"middle",fontWeight:"bold",fontSize:"12",children:["In ",M+1]}),f("text",{x:P,y:_+40,textAnchor:"middle",fontSize:"10",fill:"#555",children:A}),f("text",{x:P,y:_+52,textAnchor:"middle",fontSize:"12",fill:"#333",fontWeight:"bold",children:W.toFixed(0)})]},M)}),f("line",{x1:300,y1:v+60,x2:300,y2:v+30,stroke:"#333",strokeWidth:"2",markerEnd:"url(#arrowhead)"}),f("circle",{cx:300,cy:v+80,r:5,fill:"#2980b9"}),f("text",{x:315,y:v+80,textAnchor:"start",dominantBaseline:"middle",fill:"#2980b9",fontSize:"12",fontWeight:"bold",children:[a,": ",d.toFixed(2)]}),f("circle",{cx:300,cy:v,r:30,fill:"#fff",stroke:"#333",strokeWidth:"2","aria-label":"Output Node"}),f("text",{x:300,y:v,textAnchor:"middle",dominantBaseline:"middle",fontWeight:"bold",children:"Output"}),f("text",{x:300,y:v-45,textAnchor:"middle",fontSize:"12",fill:"#555",children:s}),f("text",{x:300,y:v-60,textAnchor:"middle",fontSize:"14",fill:"#333",fontWeight:"bold",children:S.toFixed(2)}),f("text",{x:175,y:C-10,textAnchor:"middle",fontSize:"12",fontStyle:"italic",fill:"#777",children:l})]})]})}function Ce({onGenerateData:e,onTrain:t,onRun:n,onReset:i,isTraining:l,trainingStep:o,dataCount:s,trainerType:a,onTrainerTypeChange:u}){return f("div",{role:"region","aria-label":"Steuerung",style:{padding:"20px",background:"#eee",borderRadius:"8px",display:"flex",gap:"10px",flexWrap:"wrap",alignItems:"center"},children:[f("button",{onClick:e,disabled:l,children:"1. Trainingsdaten Generieren"}),f("span",{"aria-live":"polite",children:["Datenpunkte: ",s]}),f("div",{style:{borderLeft:"1px solid #ccc",paddingLeft:"10px",marginLeft:"10px",display:"flex",gap:"5px",alignItems:"center"},children:[f("select",{value:a,onChange:h=>u(h.target.value),disabled:l,style:{padding:"8px",borderRadius:"4px",border:"1px solid #ccc"},children:[f("option",{value:"exhaustive",children:"Grid Search (Genau)"}),f("option",{value:"random",children:"Adaptive Random (Schnell)"})]}),f("button",{onClick:t,disabled:l||s===0,"aria-busy":l,children:l?"Suche läuft...":"2. Trainieren"})]}),f("button",{onClick:n,disabled:l,children:"3. Simulation Starten"}),f("button",{onClick:i,style:{marginLeft:"auto",background:"#e74c3c",color:"white"},"aria-label":"Simulation zurücksetzen",children:"Reset"})]})}class Re{constructor(t=30,n=50){this.velocity=t,this.initialPosition=n}getPosition(t){return this.velocity*t+this.initialPosition}}class Ee{constructor(){this.weight=0,this.bias=0}predict(t){return this.weight*t+this.bias}setWeight(t){this.weight=t}setBias(t){this.bias=t}}function Le({time:e,groundTruth:t,neuralNet:n,maxDistance:i=300}){const l=rt(null);mt(()=>{const s=l.current;if(!s)return;const a=s.getContext("2d"),u=s.width,h=s.height,g=50,c=u-2*g;a.clearRect(0,0,u,h);const b=t.getPosition(e),d=n.predict(e),S=g+b%i/i*c,T=g+d%i/i*c;a.fillStyle="#f0f0f0",a.fillRect(0,0,u,h/2),a.fillStyle="#e0e0e0",a.fillRect(0,h/2,u,h/2),a.beginPath(),a.strokeStyle="#fff",a.setLineDash([20,20]),a.moveTo(0,h/4),a.lineTo(u,h/4),a.moveTo(0,h*3/4),a.lineTo(u,h*3/4),a.stroke(),a.beginPath(),a.strokeStyle="#ccc",a.setLineDash([]),a.moveTo(g,0),a.lineTo(g,h),a.moveTo(u-g,0),a.lineTo(u-g,h),a.stroke(),o(a,S,h/4,"#2ecc71","Ground Truth"),o(a,T,h*3/4,"#e74c3c","Neural Net"),a.fillStyle="#333",a.font="14px monospace",a.fillText(`Zeit: ${e.toFixed(1)}s`,10,20),a.fillText(`Pos GT: ${b.toFixed(1)}m`,10,40),a.fillText(`Pos NN: ${d.toFixed(1)}m`,10,h/2+40)},[e,t,n,i]);function o(s,a,u,h,g){s.save(),s.translate(a,u),s.fillStyle=h,s.fillRect(-20,-10,40,20),s.fillStyle="#000",s.fillRect(-15,-15,10,5),s.fillRect(5,-15,10,5),s.fillRect(-15,10,10,5),s.fillRect(5,10,10,5),s.fillStyle="#000",s.font="10px sans-serif",s.textAlign="center",s.fillText(g,0,-20),s.restore()}return f("div",{style:{border:"2px solid #333",borderRadius:"8px",overflow:"hidden"},children:f("canvas",{ref:l,width:800,height:300,style:{width:"100%",display:"block"}})})}const qt={id:"physics",title:"Phase 1: Lineare Regression (Exhaustive Search 2D)",description:"Physiksimulation: Weg-Zeit-Gesetz (s = v*t + s0)",Model:Ee,GroundTruth:Re,CanvasComponent:Le,defaultParams:{weight:0,bias:0},groundTruthDefaults:[30,50],getInput:e=>e,generateData:e=>Array.from({length:20},(n,i)=>i*.5).map(n=>({input:n,target:e.getPosition(n)})),trainingConfig:{weightRange:{min:0,max:60,step:1},biasRange:{min:0,max:100,step:2}},networkViz:{formula:"pos = w * t + b",inputLabel:"Zeit (t)",outputLabel:"Pos (m)",biasLabel:"b"}};class $e{constructor(t=.5,n=-5){this.weight=t,this.bias=n}sigmoid(t){return 1/(1+Math.exp(-t))}classify(t){const n=this.sigmoid(this.weight*t+this.bias);return Math.random()<n?1:0}getProbability(t){return this.sigmoid(this.weight*t+this.bias)}}class ze{constructor(){this.weight=0,this.bias=0}sigmoid(t){return 1/(1+Math.exp(-t))}predict(t){const n=this.weight*t+this.bias;return this.sigmoid(n)}setWeight(t){this.weight=t}setBias(t){this.bias=t}}function Ne({time:e,groundTruth:t,neuralNet:n}){const i=rt(null);return mt(()=>{const l=i.current;if(!l)return;const o=l.getContext("2d"),s=l.width,a=l.height;o.clearRect(0,0,s,a);const u=40,h=s-2*u,g=a-2*u,c=0,b=20,d=m=>u+m/b*h,S=m=>a-u-m*g;o.beginPath(),o.strokeStyle="#eee";for(let m=0;m<=4;m++){const M=S(m*.25);o.moveTo(u,M),o.lineTo(s-u,M)}for(let m=0;m<=10;m++){const M=d(m*2);o.moveTo(M,u),o.lineTo(M,a-u)}o.stroke(),o.beginPath(),o.strokeStyle="#333",o.moveTo(u,u),o.lineTo(u,a-u),o.lineTo(s-u,a-u),o.stroke(),o.fillStyle="#333",o.textAlign="center",o.fillText("Anzahl 'Spam' Wörter",s/2,a-10),o.save(),o.translate(15,a/2),o.rotate(-Math.PI/2),o.fillText("Spam Wahrscheinlichkeit",0,0),o.restore();const T=(m,M,_=[])=>{o.beginPath(),o.strokeStyle=M,o.setLineDash(_),o.lineWidth=2;for(let r=c;r<=b;r+=.5){let A=0;typeof m.getProbability=="function"?A=m.getProbability(r):typeof m.predict=="function"&&(A=m.predict(r));const W=d(r),L=S(A);r===c?o.moveTo(W,L):o.lineTo(W,L)}o.stroke(),o.setLineDash([])};T(t,"#ccc",[5,5]),T(n,"#e74c3c");const p=Math.floor(e*2),x=50,P=m=>{const M=Math.sin(m*123.456)*1e4;return M-Math.floor(M)},C=Math.min(p,x);for(let m=0;m<C;m++){const M=P(m+1),_=Math.floor(M*21),r=t.getProbability(_),W=P(m+999)<r?1:0,L=d(_),k=S(W);o.beginPath();const E=(P(m+333)-.5)*10,y=(P(m+444)-.5)*10;o.arc(L+E,k+y,5,0,Math.PI*2),o.fillStyle=W?"#e74c3c":"#2ecc71",o.fill(),o.strokeStyle="#fff",o.stroke()}if(C>0&&C<=x){const m=C-1,M=P(m+1),_=Math.floor(M*21),r=t.getProbability(_),W=P(m+999)<r?1:0,L=(P(m+333)-.5)*10,k=(P(m+444)-.5)*10,E=d(_)+L,y=S(W)+k;o.beginPath(),o.arc(E,y,8,0,Math.PI*2),o.strokeStyle="#333",o.stroke(),o.fillStyle="#333",o.font="10px sans-serif",o.fillText(`${_}`,E,y-12)}},[e,t,n]),f("div",{className:"canvas-container",children:f("canvas",{ref:i,width:600,height:300,style:{width:"100%",border:"1px solid #ccc",background:"#fff"}})})}const Fe=e=>{const t=Math.sin(e)*1e4;return t-Math.floor(t)},Kt={id:"spam",title:"Phase 2: Logistische Regression (Spam Filter)",description:"Spam-Erkennung: Wahrscheinlichkeit p = σ(w*x + b)",Model:ze,GroundTruth:$e,CanvasComponent:Ne,defaultParams:{weight:0,bias:0},groundTruthDefaults:[.5,-5],getInput:e=>{const t=Math.floor(e);return Math.floor(Fe(t)*20)},generateData:e=>{const t=[];for(let n=0;n<50;n++){const i=Math.floor(Math.random()*21),l=e.classify(i);t.push({input:i,target:l})}return t.sort((n,i)=>n.input-i.input)},trainingConfig:{weightRange:{min:0,max:2,step:.1},biasRange:{min:-10,max:5,step:.5}},networkViz:{formula:"p = σ(w * x + b)",inputLabel:"Wörter (x)",outputLabel:"Spam? (p)",biasLabel:"b"},isFinished:e=>e>=25};class Ie{constructor(t=[.5,.2,.8,-.1],n=-3){this.weights=t,this.bias=n}sigmoid(t){return 1/(1+Math.exp(-t))}classify(t){let n=this.bias;for(let l=0;l<this.weights.length;l++)n+=this.weights[l]*t[l];const i=this.sigmoid(n);return Math.random()<i?1:0}getProbability(t){let n=this.bias;for(let i=0;i<this.weights.length;i++)n+=this.weights[i]*t[i];return this.sigmoid(n)}}class He{constructor(t=4){this.weights=new Array(t).fill(0),this.bias=0}sigmoid(t){return 1/(1+Math.exp(-t))}predict(t){let n=this.bias;for(let i=0;i<this.weights.length;i++)n+=this.weights[i]*t[i];return this.sigmoid(n)}setWeights(t){this.weights=[...t]}setBias(t){this.bias=t}setWeightAt(t,n){t>=0&&t<this.weights.length&&(this.weights[t]=n)}}const J=[{label:"Spam Words",idx:0,max:15},{label:"Großbuchstaben",idx:1,max:25},{label:"Links",idx:2,max:8},{label:"Gesamtworte",idx:3,max:100}];function De({data:e,currentInput:t,currentPrediction:n,neuralNet:i}){const l=rt(null),[o,s]=Q("scatter"),[a,u]=Q(0),[h,g]=Q(3),[c,b]=Q(2),[d,S]=Q({x:-.5,y:.5}),T=rt(!1),v=rt({x:0,y:0}),[p,x]=Q(null),P=_=>{o==="3d"&&(T.current=!0,v.current={x:_.clientX,y:_.clientY})},C=_=>{if(T.current&&o==="3d"){const r=_.clientX-v.current.x,A=_.clientY-v.current.y;S(W=>({x:W.x+A*.01,y:W.y+r*.01})),v.current={x:_.clientX,y:_.clientY};return}if(o==="scatter"){const r=l.current;if(!r)return;const A=r.getBoundingClientRect(),W=_.clientX-A.left,L=_.clientY-A.top;let k=null;const E=10,y=50,z=r.width-2*y,w=r.height-2*y,N=y,R=r.height-y,H=J[a].max,X=J[h].max;if(e)for(const F of e){const B=N+F.input[a]/H*z,it=R-F.input[h]/X*w;if(Math.sqrt((B-W)**2+(it-L)**2)<E){k={x:B,y:it,text:F.text,isSpam:F.target===1};break}}x(k)}else x(null)},m=()=>{T.current=!1},M=()=>{x(null)};return mt(()=>{const _=l.current;if(!_)return;const r=_.getContext("2d"),A=_.width,W=_.height;r.clearRect(0,0,A,W),r.fillStyle="#fff",r.fillRect(0,0,A,W);const L=w=>{if(!e||e.length===0)return J[w].max;const N=Math.max(...e.map(R=>R.input[w]));return N>0?N:J[w].max};if(o==="3d"){const w=L(a),N=L(h),R=L(c),H=A/2,X=W/2,F=150,B=($,D,Y)=>{let q=$*Math.cos(d.y)-Y*Math.sin(d.y),O=$*Math.sin(d.y)+Y*Math.cos(d.y),lt=D*Math.cos(d.x)-O*Math.sin(d.x),ft=D*Math.sin(d.x)+O*Math.cos(d.x);const j=400/(400-ft);return{x:H+q*j,y:X+lt*j,z:ft}},Z=[[-1,-1,-1],[1,-1,-1],[1,1,-1],[-1,1,-1],[-1,-1,1],[1,-1,1],[1,1,1],[-1,1,1]].map($=>B($[0]*F,$[1]*F,$[2]*F)),ht="#e29301ff",U="#2980b9",ot="#c00798ff",tt=($,D)=>{r.beginPath(),r.strokeStyle=D,r.lineWidth=1,$.forEach(([Y,q])=>{r.moveTo(Z[Y].x,Z[Y].y),r.lineTo(Z[q].x,Z[q].y)}),r.stroke()};tt([[0,1],[3,2],[4,5],[7,6]],ht),tt([[0,3],[1,2],[4,7],[5,6]],U),tt([[0,4],[1,5],[2,6],[3,7]],ot),r.font="bold 11px sans-serif",r.fillStyle=ht,r.fillText("X: "+J[a].label,Z[1].x,Z[1].y),r.fillStyle=U,r.fillText("Y: "+J[h].label,Z[3].x,Z[3].y),r.fillStyle=ot,r.fillText("Z: "+J[c].label,Z[4].x,Z[4].y);const et=[],nt=($,D)=>$/D*2-1;if(i&&i.weights){const $=i.weights[a]||0,D=i.weights[h]||0,Y=i.weights[c]||0,q=i.bias||0;if(Math.abs(Y)>.001){r.strokeStyle="rgba(142, 68, 173, 0.3)",r.lineWidth=1;const O=(j,K)=>{const at=(j+1)/2*w,ct=(K+1)/2*N,_e=(-$*at-D*ct-q)/Y;return nt(_e,R)},lt=(j,K)=>{if(Math.abs(j.z)<=3&&Math.abs(K.z)<=3){const at=B(j.x*F,-j.y*F,j.z*F),ct=B(K.x*F,-K.y*F,K.z*F);r.beginPath(),r.moveTo(at.x,at.y),r.lineTo(ct.x,ct.y),r.stroke()}},ft=6;for(let j=0;j<=ft;j++){const K=-1+j/ft*2,at=O(-1,K),ct=O(1,K);lt({x:-1,y:K,z:at},{x:1,y:K,z:ct})}for(let j=0;j<=ft;j++){const K=-1+j/ft*2,at=O(K,-1),ct=O(K,1);lt({x:K,y:-1,z:at},{x:K,y:1,z:ct})}}}e&&e.forEach($=>{const D=nt($.input[a],w),Y=-nt($.input[h],N),q=nt($.input[c],R),O=B(D*F,Y*F,q*F);et.push({...O,color:$.target===1?"#e74c3c":"#2ecc71",radius:3})}),et.sort(($,D)=>$.z-D.z),et.forEach($=>{r.beginPath(),r.arc($.x,$.y,$.radius,0,Math.PI*2),r.fillStyle=$.color,r.fill(),$.border&&(r.strokeStyle="#fff",r.lineWidth=2,r.stroke())});return}if(o==="scatter"){const w=L(a),N=L(h),R=50,H=A-2*R,X=W-2*R,F=R,B=W-R,it="#c0392b",Z="#2980b9";r.lineWidth=2,r.beginPath(),r.strokeStyle=it,r.moveTo(F,B),r.lineTo(F+H,B),r.stroke(),r.beginPath(),r.strokeStyle=Z,r.moveTo(F,B),r.lineTo(F,B-X),r.stroke(),r.textAlign="center",r.font="bold 14px sans-serif",r.fillStyle=it,r.fillText(`${J[a].label} (max: ${w})`,F+H/2,B+35),r.save(),r.translate(15,B-X/2),r.rotate(-Math.PI/2),r.fillStyle=Z,r.fillText(`${J[h].label} (max: ${N})`,0,0),r.restore();const ht=(U,ot,tt,et)=>{const nt=U[a],$=U[h],D=F+nt/w*H,Y=B-$/N*X;r.beginPath(),r.arc(D,Y,tt,0,2*Math.PI),r.fillStyle=ot,r.fill(),et&&(r.strokeStyle=et,r.lineWidth=2,r.stroke())};if(e&&e.forEach(U=>{ht(U.input,U.target===1?"#e74c3c":"#2ecc71",5,"#fff")}),i){let U=i.weights;const ot=i.bias||0;if(U){const tt=U[a]||0,et=U[h]||0,nt=ot,$=(Y,q)=>{const O=F+Y/w*H,lt=B-q/N*X;return{x:O,y:lt}};if(r.beginPath(),r.strokeStyle="#c0392b",r.strokeStyle="rgba(142, 68, 173, 0.8)",r.lineWidth=2,r.setLineDash([10,5]),Math.abs(et)>.001){const Y=lt=>(-tt*lt-nt)/et,q=$(0,Y(0)),O=$(w,Y(w));r.moveTo(q.x,q.y),r.lineTo(O.x,O.y)}else if(Math.abs(tt)>.001){const Y=-nt/tt,q=$(Y,0),O=$(Y,N);r.moveTo(q.x,q.y),r.lineTo(O.x,O.y)}r.stroke(),r.setLineDash([]),r.fillStyle="rgba(142, 68, 173, 1)",r.font="bold 12px monospace",r.textAlign="left";const D=`${tt.toFixed(2)}x + ${et.toFixed(2)}y + ${nt.toFixed(2)} = 0`;r.fillText(D,F+10,B-X-5)}}if(t&&ht(t,"#3498db",8,"#2980b9"),r.fillStyle="#666",r.textAlign="right",r.font="11px sans-serif",r.fillText("Rot=Spam, Grün=OK",A-10,20),p){r.save(),r.fillStyle="rgba(0,0,0,0.85)",r.strokeStyle="#fff";const U=p.text||"No Text",ot=p.isSpam?"SPAM":"HAM",tt=r.measureText(U),et=Math.max(tt.width,100)+20,nt=50;let $=p.x+15,D=p.y-15;$+et>A&&($=p.x-et-10),D+nt>W&&(D=p.y-nt-10),D<0&&(D=p.y+20),r.beginPath(),r.roundRect($,D,et,nt,5),r.fill(),r.lineWidth=1,r.stroke(),r.textBaseline="top",r.textAlign="left",r.font="bold 12px sans-serif",r.fillStyle=p.isSpam?"#e74c3c":"#2ecc71",r.fillText(ot,$+10,D+10),r.font="italic 11px sans-serif",r.fillStyle="#ddd",r.fillText(U,$+10,D+28),r.restore()}return}if(o==="text"){if(r.textAlign="center",r.textBaseline="middle",!t||!t.text){r.fillStyle="#999",r.font="20px sans-serif",r.fillText("Kein Text verfügbar",A/2,W/2);return}const w=n>.5,N=w?"#feeff0":"#effaf0";r.fillStyle=N,r.fillRect(0,0,A,W);const R=t.text;r.fillStyle="#333",r.font="24px serif";const H=R.split(" ");let X="";const F=35,B=A/2;let it=W/3;const Z=A-100;for(let ot=0;ot<H.length;ot++){const tt=X+H[ot]+" ";r.measureText(tt).width>Z&&ot>0?(r.fillText(X,B,it),X=H[ot]+" ",it+=F):X=tt}r.fillText(X,B,it),it+=60;const ht=t.groundTruth===1;r.font="bold 16px sans-serif",r.fillStyle="#555",r.fillText(`Wahrheit: ${ht?"SPAM":"HAM"}`,B,it),it+=30;const U=(n*100).toFixed(1);r.font="bold 20px sans-serif",r.fillStyle=w?"#c0392b":"#27ae60",r.fillText(`Vorhersage: ${w?"SPAM":"HAM"} (${U}%)`,B,it);return}const k=30,E=(A-3*k)/2,y=(W-3*k)/2;[{x:k,y:k,...J[0]},{x:k+E+k,y:k,...J[1]},{x:k,y:k+y+k,...J[2]},{x:k+E+k,y:k+y+k,...J[3]}].forEach(w=>{if(r.strokeStyle="#ccc",r.strokeRect(w.x,w.y,E,y),r.fillStyle="#333",r.font="12px Arial",r.textAlign="center",r.fillText(w.label,w.x+E/2,w.y-5),e&&e.forEach(N=>{const R=N.input[w.idx],H=w.x+R/w.max*E,X=w.y+y-N.target*(y-20)-10;r.beginPath(),r.arc(H,X,3,0,2*Math.PI),r.fillStyle=N.target?"rgba(231, 76, 60, 0.6)":"rgba(46, 204, 113, 0.6)",r.fill()}),t){const N=t[w.idx],R=w.x+N/w.max*E;r.beginPath(),r.moveTo(R,w.y),r.lineTo(R,w.y+y),r.strokeStyle="#3498db",r.setLineDash([5,5]),r.stroke(),r.setLineDash([])}})},[e,t,n,o,a,h,c,d]),f("div",{style:{textAlign:"center"},children:[f("div",{style:{marginBottom:"10px",display:"flex",gap:"5px",justifyContent:"center",flexWrap:"wrap",fontSize:"0.9rem"},children:[f("select",{value:o,onChange:_=>s(_.target.value),style:{padding:"4px"},children:[f("option",{value:"features",children:"Alle Features"}),f("option",{value:"scatter",children:"2D Plot"}),f("option",{value:"3d",children:"3D Plot"}),f("option",{value:"text",children:"Text Mode"})]}),(o==="scatter"||o==="3d")&&f(dt,{children:[f("span",{children:"X:"}),f("select",{value:a,onChange:_=>u(parseInt(_.target.value)),style:{padding:"4px"},children:J.map(_=>f("option",{value:_.idx,children:_.label},_.idx))}),f("span",{children:"Y:"}),f("select",{value:h,onChange:_=>g(parseInt(_.target.value)),style:{padding:"4px"},children:J.map(_=>f("option",{value:_.idx,children:_.label},_.idx))})]}),o==="3d"&&f(dt,{children:[f("span",{children:"Z:"}),f("select",{value:c,onChange:_=>b(parseInt(_.target.value)),style:{padding:"4px"},children:J.map(_=>f("option",{value:_.idx,children:_.label},_.idx))})]})]}),f("canvas",{ref:l,width:600,height:400,style:{border:"1px solid #eee",maxWidth:"100%",borderRadius:"4px",cursor:o==="3d"?"grab":"default"},onMouseDown:P,onMouseMove:C,onMouseUp:m,onMouseLeave:m,onMouseOut:M}),f("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"5px"},children:o==="3d"?"Drag to rotate 3D view":"Wähle Achsen für die Visualisierung"})]})}const Jt=e=>{const t=Math.sin(e)*1e4;return t-Math.floor(t)},Pt=e=>{const t=["winner","won","gift card","urgent","rolex","viagra","cash","prize","singles","marketing","buy","free","money","security alert","click","claim","fake","verification"],n=e.toLowerCase();let i=0;t.forEach(a=>{n.includes(a)&&(i+=1)}),i>10&&(i=10);const l=(e.match(/[A-Z]/g)||[]).length,o=(e.match(/http/g)||[]).length,s=e.split(/\s+/).length;return[i,l,o,s]},_t={id:"spam_advanced",title:"Phase 3: Erweiterter Spam-Filter (4 Eingaben)",description:"Spam-Erkennung mit 4 Merkmalen: Spam-Worte, Großbuchstaben, Links, Gesamtworte.",Model:He,GroundTruth:Ie,CanvasComponent:De,defaultParams:{weights:[0,0,0,0],bias:0},groundTruthDefaults:[[1.5,.5,2,-.5],-5],getInput:e=>{const t=Math.floor(e*.3),n=Jt(t)>.5,i=n?_t.examples.spam:_t.examples.ham,l=Math.floor(Jt(t+99)*i.length),o=i[l],s=Pt(o);return s.text=o,s.groundTruth=n?1:0,s},examples:{spam:["WINNER! Won $1000 Gift Card! Claim at http://prize-giveaway.net","URGENT: Verify account at http://secure-bank-login.com/fraud","Cheap Rolex watches! 50% OFF at www.fake-watches.cn","Lose weight fast! Buy pills: http://diet-miracle.com","CONGRATS! Cash prize waiting: http://claim-money.org","HOT singles waiting! Chat now: http://local-dating.xyz","Refinance 1% APR. Apply: http://easy-loans.biz","Buy 1 get 1 FREE Viagra. http://meds-direct.com","Meet rich men. Signup: http://millionaire-match.com","SECURITY ALERT: Suspicious activity. Check http://account-security-check.com"],ham:["Meeting agenda for tomorrow's team sync","Hey, are we still on for lunch?","Invoice #12345 from AWS Services","Project deadline extended to Friday","Happy Birthday! Hope you have a great day.","Can you review this pull request?","Your Amazon order has shipped.","Fwd: Tickets for the concert","Question about the quarterly report","Let's catch up sometime next week."]},generateData:e=>{const t=[];_t.examples.spam.forEach(n=>{const i=Pt(n),l=()=>(Math.random()-.5)*.1,o=i.map(s=>Math.max(0,s+l()));t.push({input:o,target:1,text:n})}),_t.examples.ham.forEach(n=>{const l=Pt(n).map(o=>Math.max(0,o+(Math.random()-.5)*.1));t.push({input:l,target:0,text:n})});for(let n=t.length-1;n>0;n--){const i=Math.floor(Math.random()*(n+1));[t[n],t[i]]=[t[i],t[n]]}return t},trainingConfig:{params:[{name:"w1 (Spam-Worte)",min:1,max:4,step:.5},{name:"w2 (Großbuchst.)",min:0,max:2,step:.5},{name:"w3 (Links)",min:0,max:3,step:.5},{name:"w4 (Gesamtworte)",min:-2,max:2,step:.5},{name:"bias",min:-8,max:8,step:2}]},networkViz:{formula:"p = σ(w₁x₁ + w₂x₂ + w₃x₃ + w₄x₄ + b)",inputLabels:["Spam-Worte","Großbuchst.","Links","Gesamtworte"],outputLabel:"Spam? (p)",biasLabel:"b"},isFinished:e=>e>=50},Qt={[qt.id]:qt,[Kt.id]:Kt,[_t.id]:_t};function Xe(e){return Qt[e]||Qt.physics}function Be(){const[e,t]=Q(null),n=rt(null),i=rt(null),[l,o]=Q(0),[s,a]=Q(!1),[u,h]=Q([]),[g,c]=Q([]),[b,d]=Q(-1),[S,T]=Q(!1),[v,p]=Q("simulation"),[x,P]=Q("exhaustive"),[C,m]=Q("Bereit."),M=rt(0);mt(()=>{const z=new URLSearchParams(window.location.search).get("sim")||"physics",w=Xe(z);if(!w){m("Fehler: Simulation nicht gefunden.");return}try{n.current=new w.GroundTruth(...w.groundTruthDefaults||[]),i.current=new w.Model,w.defaultParams&&(w.defaultParams.weight!==void 0&&i.current.setWeight(w.defaultParams.weight),w.defaultParams.weights!==void 0&&i.current.setWeights&&i.current.setWeights(w.defaultParams.weights),w.defaultParams.bias!==void 0&&i.current.setBias(w.defaultParams.bias)),t(w)}catch(N){console.error("Initialization Error:",N),m(`Init Fehler: ${N.message}`)}},[]),mt(()=>{let y;const z=w=>{if(!s)return;M.current===0&&(M.current=w);const N=(w-M.current)/1e3;M.current=w;const R=Math.min(N,.1);o(H=>{const F=H+R*3;return e&&e.isFinished&&e.isFinished(F)&&(a(!1),m("Simulation beendet.")),F}),y=requestAnimationFrame(z)};return s&&(M.current=0,y=requestAnimationFrame(z)),()=>cancelAnimationFrame(y)},[s,e]);const _=()=>{try{if(!e)return;if(!n.current)throw new Error("Ground Truth not initialized");const y=e.generateData(n.current);h(y),m(`${y.length} Trainingsdaten generiert.`),p("data")}catch(y){console.error("Generate Data Error:",y),m(`Fehler beim Generieren: ${y.message}`)}},r=async()=>{try{if(u.length===0||!e)return;T(!0),d(0),c([]),m("Suche optimales Gewicht und Bias (Live Visualisierung)..."),p("training");const y=new Ae(i.current),z=(N,R)=>{if(c(H=>{const X=[...H,...N];return d(X.length-1),X}),(R&&R.message||R&&R.message)&&m(R.message),R&&R.bestParams){if(i.current.setWeights){const{weights:H,bias:X}=R.bestParams;i.current.setWeights(H),i.current.setBias(X)}}else R&&R.bestWeight!==void 0&&(i.current.setWeight(R.bestWeight),i.current.setBias(R.bestBias))};let w;x==="random"?(m("Suche optimales Gewicht und Bias (Random Search)..."),w=await y.trainRandomAsync(u,e.trainingConfig.params,z)):e.trainingConfig.params?w=await y.trainAsync(u,e.trainingConfig.params,z):w=await y.trainAsync(u,e.trainingConfig.weightRange,e.trainingConfig.biasRange,z),m(`Training fertig! Min Error: ${w.minError.toFixed(5)}`),T(!1)}catch(y){console.error("Training Error:",y),T(!1),m(`Fehler beim Training: ${y.message}`)}},A=()=>{o(0),a(!0),m("Simulation läuft..."),p("simulation")},W=()=>{a(!1),o(0),h([]),c([]),d(-1);try{i.current&&e?.defaultParams&&(e.defaultParams.weight!==void 0&&i.current.setWeight(e.defaultParams.weight),e.defaultParams.weights!==void 0&&i.current.setWeights&&i.current.setWeights(e.defaultParams.weights),e.defaultParams.bias!==void 0&&i.current.setBias(e.defaultParams.bias))}catch(y){console.error("Reset Error:",y)}m("Reset durchgeführt.")};if(!e)return f("div",{children:"Lade Simulation..."});const L=e.CanvasComponent,k=e.networkViz||{},E=e.getInput?e.getInput(l):l;return f("div",{className:"container",children:[f("header",{children:[f("h1",{children:"Neural Network Demonstrator"}),f("p",{children:e.title}),f("div",{className:"sim-selector",style:{fontSize:"0.8rem",marginTop:"5px"},children:[f("a",{href:"?sim=physics",style:{marginRight:"10px",fontWeight:e.id==="physics"?"bold":"normal"},children:"Phase 1 (Physik)"}),f("a",{href:"?sim=spam",style:{marginRight:"10px",fontWeight:e.id==="spam"?"bold":"normal"},children:"Phase 2 (Spam)"}),f("a",{href:"?sim=spam_advanced",style:{fontWeight:e.id==="spam_advanced"?"bold":"normal"},children:"Phase 3 (Spam Extended)"})]})]}),f("main",{children:[f("div",{className:"top-section",style:{display:"flex",gap:"20px",flexWrap:"wrap",alignItems:"start"},children:[f("div",{className:"simulation-wrapper",style:{flex:"1 1 500px"},children:f("div",{className:"simulation-section",children:[f("div",{className:"tabs",children:[f("button",{className:`tab-button ${v==="simulation"?"active":""}`,onClick:()=>p("simulation"),children:"Simulation"}),f("button",{className:`tab-button ${v==="data"?"active":""}`,onClick:()=>p("data"),children:"Trainingsdaten"}),f("button",{className:`tab-button ${v==="training"?"active":""}`,onClick:()=>p("training"),children:"Training"})]}),v==="simulation"&&f(dt,{children:[(()=>{let y=0;try{i.current&&(y=i.current.predict(E))}catch(z){console.error("Predict Error",z)}return f(L,{time:l,data:u,currentInput:E,currentPrediction:y,groundTruth:n.current,neuralNet:i.current})})(),f("div",{className:"stats",style:{marginTop:"10px"},children:[f("p",{children:e.description}),f("p",{style:{color:"#646cff",fontWeight:"bold"},children:["Status: ",C]})]})]}),v==="data"&&f("div",{className:"data-content",children:u.length>0?f("div",{style:{maxHeight:"400px",overflowY:"auto"},children:f("table",{style:{width:"100%",textAlign:"left",borderCollapse:"collapse",fontSize:"0.9rem"},children:[f("thead",{children:f("tr",{style:{background:"#eee",borderBottom:"2px solid #ddd"},children:[Array.isArray(k.inputLabels)?k.inputLabels.map((y,z)=>f("th",{style:{padding:"8px"},children:y},z)):f("th",{style:{padding:"8px"},children:["Input (",k.inputLabel,")"]}),f("th",{style:{padding:"8px"},children:"Target"}),f("th",{style:{padding:"8px"},children:"E-Mail Text"})]})}),f("tbody",{children:u.map((y,z)=>{const w=y.target===1;return f("tr",{style:{background:w?"#ffebee":"#e8f5e9",borderBottom:"1px solid #ddd"},children:[Array.isArray(y.input)?y.input.map((R,H)=>f("td",{style:{padding:"8px"},children:R.toFixed(0)},H)):f("td",{style:{padding:"8px"},children:y.input.toFixed(2)}),f("td",{style:{padding:"8px",fontWeight:"bold",color:w?"#c0392b":"#27ae60"},children:w?"SPAM":"HAM"}),f("td",{style:{padding:"8px",color:"#555",fontStyle:"italic",maxWidth:"300px"},children:y.text||"-"})]},z)})})]})}):f("p",{style:{padding:"20px",textAlign:"center",color:"#666"},children:"Noch keine Trainingsdaten generiert."})}),v==="training"&&f("div",{className:"training-content",children:g.length>0?f(Pe,{history:g,currentStepIndex:b,isTraining:S,paramsConfig:e.trainingConfig.params}):f("p",{style:{padding:"20px",textAlign:"center",color:"#666"},children:"Noch kein Training gestartet."})})]})}),f("div",{className:"network-wrapper",style:{flex:"0 0 350px"},children:f(We,{input:E,weight:i.current?i.current.weights||i.current.weight:0,bias:i.current?i.current.bias:0,output:i.current?i.current.predict(E):0,formula:k.formula,inputLabel:k.inputLabels||k.inputLabel,outputLabel:k.outputLabel,biasLabel:k.biasLabel})})]}),f(Ce,{onGenerateData:_,onTrain:r,onRun:A,onReset:W,isTraining:S,trainingStep:b,dataCount:u.length,trainerType:x,onTrainerTypeChange:P})]})]})}ve(f(Be,{}),document.getElementById("app"));
