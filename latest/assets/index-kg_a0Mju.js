(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))i(l);new MutationObserver(l=>{for(const r of l)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(l){const r={};return l.integrity&&(r.integrity=l.integrity),l.referrerPolicy&&(r.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?r.credentials="include":l.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(l){if(l.ep)return;l.ep=!0;const r=n(l);fetch(l.href,r)}})();var Mt,D,ee,ut,zt,ne,ie,re,Lt,Wt,Ct,gt={},se=[],ge=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Tt=Array.isArray;function st(e,t){for(var n in t)e[n]=t[n];return e}function It(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function xe(e,t,n){var i,l,r,s={};for(r in t)r=="key"?i=t[r]:r=="ref"?l=t[r]:s[r]=t[r];if(arguments.length>2&&(s.children=arguments.length>3?Mt.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(r in e.defaultProps)s[r]===void 0&&(s[r]=e.defaultProps[r]);return bt(e,s,i,l,null)}function bt(e,t,n,i,l){var r={type:e,props:t,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:l??++ee,__i:-1,__u:0};return l==null&&D.vnode!=null&&D.vnode(r),r}function ht(e){return e.children}function vt(e,t){this.props=e,this.context=t}function pt(e,t){if(t==null)return e.__?pt(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?pt(e):null}function oe(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return oe(e)}}function Ht(e){(!e.__d&&(e.__d=!0)&&ut.push(e)&&!St.__r++||zt!=D.debounceRendering)&&((zt=D.debounceRendering)||ne)(St)}function St(){for(var e,t,n,i,l,r,s,a=1;ut.length;)ut.length>a&&ut.sort(ie),e=ut.shift(),a=ut.length,e.__d&&(n=void 0,i=void 0,l=(i=(t=e).__v).__e,r=[],s=[],t.__P&&((n=st({},i)).__v=i.__v+1,D.vnode&&D.vnode(n),$t(t.__P,n,i,t.__n,t.__P.namespaceURI,32&i.__u?[l]:null,r,l??pt(i),!!(32&i.__u),s),n.__v=i.__v,n.__.__k[n.__i]=n,ce(r,n,s),i.__e=i.__=null,n.__e!=l&&oe(n)));St.__r=0}function le(e,t,n,i,l,r,s,a,d,h,x){var c,v,u,S,T,A,m,y=i&&i.__k||se,W=t.length;for(d=ye(n,t,y,d,W),c=0;c<W;c++)(u=n.__k[c])!=null&&(v=u.__i==-1?gt:y[u.__i]||gt,u.__i=c,A=$t(e,u,v,l,r,s,a,d,h,x),S=u.__e,u.ref&&v.ref!=u.ref&&(v.ref&&Nt(v.ref,null,u),x.push(u.ref,u.__c||S,u)),T==null&&S!=null&&(T=S),(m=!!(4&u.__u))||v.__k===u.__k?d=ae(u,d,e,m):typeof u.type=="function"&&A!==void 0?d=A:S&&(d=S.nextSibling),u.__u&=-7);return n.__e=T,d}function ye(e,t,n,i,l){var r,s,a,d,h,x=n.length,c=x,v=0;for(e.__k=new Array(l),r=0;r<l;r++)(s=t[r])!=null&&typeof s!="boolean"&&typeof s!="function"?(typeof s=="string"||typeof s=="number"||typeof s=="bigint"||s.constructor==String?s=e.__k[r]=bt(null,s,null,null,null):Tt(s)?s=e.__k[r]=bt(ht,{children:s},null,null,null):s.constructor==null&&s.__b>0?s=e.__k[r]=bt(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):e.__k[r]=s,d=r+v,s.__=e,s.__b=e.__b+1,a=null,(h=s.__i=be(s,n,d,c))!=-1&&(c--,(a=n[h])&&(a.__u|=2)),a==null||a.__v==null?(h==-1&&(l>x?v--:l<x&&v++),typeof s.type!="function"&&(s.__u|=4)):h!=d&&(h==d-1?v--:h==d+1?v++:(h>d?v--:v++,s.__u|=4))):e.__k[r]=null;if(c)for(r=0;r<x;r++)(a=n[r])!=null&&(2&a.__u)==0&&(a.__e==i&&(i=pt(a)),fe(a,a));return i}function ae(e,t,n,i){var l,r;if(typeof e.type=="function"){for(l=e.__k,r=0;l&&r<l.length;r++)l[r]&&(l[r].__=e,t=ae(l[r],t,n,i));return t}e.__e!=t&&(i&&(t&&e.type&&!t.parentNode&&(t=pt(e)),n.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function be(e,t,n,i){var l,r,s,a=e.key,d=e.type,h=t[n],x=h!=null&&(2&h.__u)==0;if(h===null&&a==null||x&&a==h.key&&d==h.type)return n;if(i>(x?1:0)){for(l=n-1,r=n+1;l>=0||r<t.length;)if((h=t[s=l>=0?l--:r++])!=null&&(2&h.__u)==0&&a==h.key&&d==h.type)return s}return-1}function Dt(e,t,n){t[0]=="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||ge.test(t)?n:n+"px"}function yt(e,t,n,i,l){var r,s;t:if(t=="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof i=="string"&&(e.style.cssText=i=""),i)for(t in i)n&&t in n||Dt(e.style,t,"");if(n)for(t in n)i&&n[t]==i[t]||Dt(e.style,t,n[t])}else if(t[0]=="o"&&t[1]=="n")r=t!=(t=t.replace(re,"$1")),s=t.toLowerCase(),t=s in e||t=="onFocusOut"||t=="onFocusIn"?s.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+r]=n,n?i?n.u=i.u:(n.u=Lt,e.addEventListener(t,r?Ct:Wt,r)):e.removeEventListener(t,r?Ct:Wt,r);else{if(l=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=n??"";break t}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&n==1?"":n))}}function Bt(e){return function(t){if(this.l){var n=this.l[t.type+e];if(t.t==null)t.t=Lt++;else if(t.t<n.u)return;return n(D.event?D.event(t):t)}}}function $t(e,t,n,i,l,r,s,a,d,h){var x,c,v,u,S,T,A,m,y,W,C,g,P,_,o,k,M,L=t.type;if(t.constructor!=null)return null;128&n.__u&&(d=!!(32&n.__u),r=[a=t.__e=n.__e]),(x=D.__b)&&x(t);t:if(typeof L=="function")try{if(m=t.props,y="prototype"in L&&L.prototype.render,W=(x=L.contextType)&&i[x.__c],C=x?W?W.props.value:x.__:i,n.__c?A=(c=t.__c=n.__c).__=c.__E:(y?t.__c=c=new L(m,C):(t.__c=c=new vt(m,C),c.constructor=L,c.render=we),W&&W.sub(c),c.state||(c.state={}),c.__n=i,v=c.__d=!0,c.__h=[],c._sb=[]),y&&c.__s==null&&(c.__s=c.state),y&&L.getDerivedStateFromProps!=null&&(c.__s==c.state&&(c.__s=st({},c.__s)),st(c.__s,L.getDerivedStateFromProps(m,c.__s))),u=c.props,S=c.state,c.__v=t,v)y&&L.getDerivedStateFromProps==null&&c.componentWillMount!=null&&c.componentWillMount(),y&&c.componentDidMount!=null&&c.__h.push(c.componentDidMount);else{if(y&&L.getDerivedStateFromProps==null&&m!==u&&c.componentWillReceiveProps!=null&&c.componentWillReceiveProps(m,C),t.__v==n.__v||!c.__e&&c.shouldComponentUpdate!=null&&c.shouldComponentUpdate(m,c.__s,C)===!1){for(t.__v!=n.__v&&(c.props=m,c.state=c.__s,c.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function(w){w&&(w.__=t)}),g=0;g<c._sb.length;g++)c.__h.push(c._sb[g]);c._sb=[],c.__h.length&&s.push(c);break t}c.componentWillUpdate!=null&&c.componentWillUpdate(m,c.__s,C),y&&c.componentDidUpdate!=null&&c.__h.push(function(){c.componentDidUpdate(u,S,T)})}if(c.context=C,c.props=m,c.__P=e,c.__e=!1,P=D.__r,_=0,y){for(c.state=c.__s,c.__d=!1,P&&P(t),x=c.render(c.props,c.state,c.context),o=0;o<c._sb.length;o++)c.__h.push(c._sb[o]);c._sb=[]}else do c.__d=!1,P&&P(t),x=c.render(c.props,c.state,c.context),c.state=c.__s;while(c.__d&&++_<25);c.state=c.__s,c.getChildContext!=null&&(i=st(st({},i),c.getChildContext())),y&&!v&&c.getSnapshotBeforeUpdate!=null&&(T=c.getSnapshotBeforeUpdate(u,S)),k=x,x!=null&&x.type===ht&&x.key==null&&(k=he(x.props.children)),a=le(e,Tt(k)?k:[k],t,n,i,l,r,s,a,d,h),c.base=t.__e,t.__u&=-161,c.__h.length&&s.push(c),A&&(c.__E=c.__=null)}catch(w){if(t.__v=null,d||r!=null)if(w.then){for(t.__u|=d?160:128;a&&a.nodeType==8&&a.nextSibling;)a=a.nextSibling;r[r.indexOf(a)]=null,t.__e=a}else{for(M=r.length;M--;)It(r[M]);Rt(t)}else t.__e=n.__e,t.__k=n.__k,w.then||Rt(t);D.__e(w,t,n)}else r==null&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):a=t.__e=ve(n.__e,t,n,i,l,r,s,d,h);return(x=D.diffed)&&x(t),128&t.__u?void 0:a}function Rt(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(Rt)}function ce(e,t,n){for(var i=0;i<n.length;i++)Nt(n[i],n[++i],n[++i]);D.__c&&D.__c(t,e),e.some(function(l){try{e=l.__h,l.__h=[],e.some(function(r){r.call(l)})}catch(r){D.__e(r,l.__v)}})}function he(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:Tt(e)?e.map(he):st({},e)}function ve(e,t,n,i,l,r,s,a,d){var h,x,c,v,u,S,T,A=n.props||gt,m=t.props,y=t.type;if(y=="svg"?l="http://www.w3.org/2000/svg":y=="math"?l="http://www.w3.org/1998/Math/MathML":l||(l="http://www.w3.org/1999/xhtml"),r!=null){for(h=0;h<r.length;h++)if((u=r[h])&&"setAttribute"in u==!!y&&(y?u.localName==y:u.nodeType==3)){e=u,r[h]=null;break}}if(e==null){if(y==null)return document.createTextNode(m);e=document.createElementNS(l,y,m.is&&m),a&&(D.__m&&D.__m(t,r),a=!1),r=null}if(y==null)A===m||a&&e.data==m||(e.data=m);else{if(r=r&&Mt.call(e.childNodes),!a&&r!=null)for(A={},h=0;h<e.attributes.length;h++)A[(u=e.attributes[h]).name]=u.value;for(h in A)if(u=A[h],h!="children"){if(h=="dangerouslySetInnerHTML")c=u;else if(!(h in m)){if(h=="value"&&"defaultValue"in m||h=="checked"&&"defaultChecked"in m)continue;yt(e,h,null,u,l)}}for(h in m)u=m[h],h=="children"?v=u:h=="dangerouslySetInnerHTML"?x=u:h=="value"?S=u:h=="checked"?T=u:a&&typeof u!="function"||A[h]===u||yt(e,h,u,A[h],l);if(x)a||c&&(x.__html==c.__html||x.__html==e.innerHTML)||(e.innerHTML=x.__html),t.__k=[];else if(c&&(e.innerHTML=""),le(t.type=="template"?e.content:e,Tt(v)?v:[v],t,n,i,y=="foreignObject"?"http://www.w3.org/1999/xhtml":l,r,s,r?r[0]:n.__k&&pt(n,0),a,d),r!=null)for(h=r.length;h--;)It(r[h]);a||(h="value",y=="progress"&&S==null?e.removeAttribute("value"):S!=null&&(S!==e[h]||y=="progress"&&!S||y=="option"&&S!=A[h])&&yt(e,h,S,A[h],l),h="checked",T!=null&&T!=e[h]&&yt(e,h,T,A[h],l))}return e}function Nt(e,t,n){try{if(typeof e=="function"){var i=typeof e.__u=="function";i&&e.__u(),i&&t==null||(e.__u=e(t))}else e.current=t}catch(l){D.__e(l,n)}}function fe(e,t,n){var i,l;if(D.unmount&&D.unmount(e),(i=e.ref)&&(i.current&&i.current!=e.__e||Nt(i,null,t)),(i=e.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(r){D.__e(r,t)}i.base=i.__P=null}if(i=e.__k)for(l=0;l<i.length;l++)i[l]&&fe(i[l],t,n||typeof e.type!="function");n||It(e.__e),e.__c=e.__=e.__e=void 0}function we(e,t,n){return this.constructor(e,n)}function Se(e,t,n){var i,l,r,s;t==document&&(t=document.documentElement),D.__&&D.__(e,t),l=(i=!1)?null:t.__k,r=[],s=[],$t(t,e=t.__k=xe(ht,null,[e]),l||gt,gt,t.namespaceURI,l?null:t.firstChild?Mt.call(t.childNodes):null,r,l?l.__e:t.firstChild,i,s),ce(r,e,s)}Mt=se.slice,D={__e:function(e,t,n,i){for(var l,r,s;t=t.__;)if((l=t.__c)&&!l.__)try{if((r=l.constructor)&&r.getDerivedStateFromError!=null&&(l.setState(r.getDerivedStateFromError(e)),s=l.__d),l.componentDidCatch!=null&&(l.componentDidCatch(e,i||{}),s=l.__d),s)return l.__E=l}catch(a){e=a}throw e}},ee=0,vt.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=st({},this.state),typeof e=="function"&&(e=e(st({},n),this.props)),e&&st(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),Ht(this))},vt.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),Ht(this))},vt.prototype.render=ht,ut=[],ne=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ie=function(e,t){return e.__v.__b-t.__v.__b},St.__r=0,re=/(PointerCapture)$|Capture$/i,Lt=0,Wt=Bt(!1),Ct=Bt(!0);var ke=0;function f(e,t,n,i,l,r){t||(t={});var s,a,d=t;if("ref"in d)for(a in d={},t)a=="ref"?s=t[a]:d[a]=t[a];var h={type:e,props:d,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--ke,__i:-1,__u:0,__source:l,__self:r};if(typeof e=="function"&&(s=e.defaultProps))for(a in s)d[a]===void 0&&(d[a]=s[a]);return D.vnode&&D.vnode(h),h}var xt,X,At,Gt,kt=0,de=[],U=D,Xt=U.__b,Yt=U.__r,Ut=U.diffed,Vt=U.__c,Ot=U.unmount,jt=U.__;function Ft(e,t){U.__h&&U.__h(X,e,kt||t),kt=0;var n=X.__H||(X.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function Z(e){return kt=1,Me(_e,e)}function Me(e,t,n){var i=Ft(xt++,2);if(i.t=e,!i.__c&&(i.__=[_e(void 0,t),function(a){var d=i.__N?i.__N[0]:i.__[0],h=i.t(d,a);d!==h&&(i.__N=[h,i.__[1]],i.__c.setState({}))}],i.__c=X,!X.__f)){var l=function(a,d,h){if(!i.__c.__H)return!0;var x=i.__c.__H.__.filter(function(v){return!!v.__c});if(x.every(function(v){return!v.__N}))return!r||r.call(this,a,d,h);var c=i.__c.props!==a;return x.forEach(function(v){if(v.__N){var u=v.__[0];v.__=v.__N,v.__N=void 0,u!==v.__[0]&&(c=!0)}}),r&&r.call(this,a,d,h)||c};X.__f=!0;var r=X.shouldComponentUpdate,s=X.componentWillUpdate;X.componentWillUpdate=function(a,d,h){if(this.__e){var x=r;r=void 0,l(a,d,h),r=x}s&&s.call(this,a,d,h)},X.shouldComponentUpdate=l}return i.__N||i.__}function mt(e,t){var n=Ft(xt++,3);!U.__s&&ue(n.__H,t)&&(n.__=e,n.u=t,X.__H.__h.push(n))}function ot(e){return kt=5,Te(function(){return{current:e}},[])}function Te(e,t){var n=Ft(xt++,7);return ue(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function Ae(){for(var e;e=de.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(wt),e.__H.__h.forEach(Et),e.__H.__h=[]}catch(t){e.__H.__h=[],U.__e(t,e.__v)}}U.__b=function(e){X=null,Xt&&Xt(e)},U.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),jt&&jt(e,t)},U.__r=function(e){Yt&&Yt(e),xt=0;var t=(X=e.__c).__H;t&&(At===X?(t.__h=[],X.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(t.__h.forEach(wt),t.__h.forEach(Et),t.__h=[],xt=0)),At=X},U.diffed=function(e){Ut&&Ut(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(de.push(t)!==1&&Gt===U.requestAnimationFrame||((Gt=U.requestAnimationFrame)||Pe)(Ae)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),At=X=null},U.__c=function(e,t){t.some(function(n){try{n.__h.forEach(wt),n.__h=n.__h.filter(function(i){return!i.__||Et(i)})}catch(i){t.some(function(l){l.__h&&(l.__h=[])}),t=[],U.__e(i,n.__v)}}),Vt&&Vt(e,t)},U.unmount=function(e){Ot&&Ot(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(i){try{wt(i)}catch(l){t=l}}),n.__H=void 0,t&&U.__e(t,n.__v))};var Zt=typeof requestAnimationFrame=="function";function Pe(e){var t,n=function(){clearTimeout(i),Zt&&cancelAnimationFrame(t),setTimeout(e)},i=setTimeout(n,35);Zt&&(t=requestAnimationFrame(n))}function wt(e){var t=X,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),X=t}function Et(e){var t=X;e.__c=e.__(),X=t}function ue(e,t){return!e||e.length!==t.length||t.some(function(n,i){return n!==e[i]})}function _e(e,t){return typeof t=="function"?t(e):t}class We{constructor(t){this.model=t}train(t,n,i){if(i!==void 0)return this.trainLegacy(t,n,i);const l=n,r=[];let s=1/0,a={};const d=x=>{const c=[];if(x.step<=0)return[x.min];for(let v=x.min;v<=x.max+1e-4;v+=x.step)c.push(parseFloat(v.toFixed(2)));return c},h=(x,c)=>{if(console.log({paramIndex:x,currentParams:c}),x===l.length){const S=[];let T=0;c.forEach((C,g)=>{l[g].name.toLowerCase().includes("bias")?T=C:S.push(C)}),this.model.setWeights?this.model.setWeights(S):this.model.setWeight&&this.model.setWeight(S[0]),this.model.setBias(T);let A=0,m=0;for(const C of t){const g=this.model.predict(C.input),P=C.target-g;A+=P*P,m+=Math.abs(P)}const y=A/t.length,W=m/t.length;y<s&&(s=y,a={weights:[...S],bias:T}),r.push({params:[...c],error:y,mae:W});return}const v=l[x],u=d(v);for(const S of u)c[x]=S,h(x+1,c)};return h(0,new Array(l.length)),{bestParams:a,history:r,minError:s}}trainLegacy(t,n,i){const l=[];let r=n.min,s=i.min,a=1/0;for(let d=n.min;d<=n.max;d+=n.step)for(let h=i.min;h<=i.max;h+=i.step){const x=parseFloat(d.toFixed(2)),c=parseFloat(h.toFixed(2));this.model.setWeight(x),this.model.setBias(c);let v=0,u=0;for(const A of t){const m=this.model.predict(A.input),y=A.target-m;v+=y*y,u+=Math.abs(y)}const S=v/t.length,T=u/t.length;S<a&&(a=S,r=x,s=c),l.push({weight:x,bias:c,error:S,mae:T})}return{bestWeight:r,bestBias:s,history:l}}async trainAsync(t,n,i){if(!Array.isArray(n)){const u=arguments[1],S=arguments[2],T=arguments[3];let A=u.min,m=S.min,y=1/0,W=[];const C=20;let g=0;for(let P=u.min;P<=u.max;P+=u.step)for(let _=S.min;_<=S.max;_+=S.step){const o=parseFloat(P.toFixed(2)),k=parseFloat(_.toFixed(2));this.model.setWeight(o),this.model.setBias(k);let M=0,L=0;for(const N of t){const b=this.model.predict(N.input),I=N.target-b;M+=I*I,L+=Math.abs(I)}const w=M/t.length,R=L/t.length;w<y&&(y=w,A=o,m=k);const p={weight:o,bias:k,error:w,mae:R};W.push(p),g++,g%C===0&&(T&&T(W,{bestWeight:A,bestBias:m,minError:y}),W=[],await new Promise(N=>setTimeout(N,0)))}return W.length>0&&T&&T(W,{bestWeight:A,bestBias:m,minError:y}),{bestWeight:A,bestBias:m,minError:y}}let r=1/0,s={},a=0;const d=50;let h=[];const x=u=>{const S=[];if(u.step<=0)return[u.min];for(let T=u.min;T<=u.max+1e-4;T+=u.step)S.push(parseFloat(T.toFixed(2)));return S},c=n.map(x),v=async(u,S)=>{if(u===n.length){const A=[];let m=0;S.forEach((_,o)=>{n[o].name.toLowerCase().includes("bias")?m=_:A.push(_)}),this.model.setWeights?this.model.setWeights(A):this.model.setWeight&&this.model.setWeight(A[0]),this.model.setBias(m);let y=0,W=0;for(const _ of t){const o=this.model.predict(_.input),k=_.target-o;y+=k*k,W+=Math.abs(k)}const C=y/t.length,g=W/t.length;C<r&&(r=C,s={weights:[...A],bias:m});const P={params:[...S],error:C,mae:g};h.push(P),a++,a%d===0&&(i&&i(h,{bestParams:s,minError:r}),h=[],await new Promise(_=>setTimeout(_,0)));return}const T=c[u];for(const A of T)S[u]=A,await v(u+1,S)};return await v(0,new Array(n.length)),h.length>0&&i&&i(h,{bestParams:s,minError:r}),{bestParams:s,minError:r}}async trainRandomAsync(t,n,i){let a=1/0,d={},h=n.map(m=>({min:m.min,max:m.max,span:m.max-m.min})),x=h.map(m=>m.min+Math.random()*m.span);const c=m=>{const y=[];let W=0;m.forEach((P,_)=>{n[_].name.toLowerCase().includes("bias")?W=P:y.push(P)}),this.model.setWeights?this.model.setWeights(y):this.model.setWeight&&this.model.setWeight(y[0]),this.model.setBias(W);let C=0,g=0;for(const P of t){const _=this.model.predict(P.input),o=P.target-_;C+=o*o,g+=Math.abs(o)}return{mse:C/t.length,mae:g/t.length,weights:y,bias:W}};let v=c(x);a=v.mse,d={weights:v.weights,bias:v.bias,_array:[...x]},i&&i([{params:[...x],error:a,mae:v.mae}],{bestParams:d,minError:a}),await new Promise(m=>setTimeout(m,0));let u=[];const S=10;let T=a,A=[...x];for(let m=0;m<1e4;m++){const W=m<9e3;let C,g;if(W){const w=m/9e3;C=.2*(1-w*.5),g=.5*(1-w*.5)}else C=.1*(1-(m-9e3)/999.9999999999998),g=.5*.5*Math.pow(.992,m-1e4*.9);let P=!1;const _=[...A];let o=!1;for(;!o;)_.forEach((w,R)=>{if(Math.random()<.4)return;o=!0;const p=h[R];let N=!1;if(W){const H=p.span*.15;w<p.min+H&&(p.min-=p.span*.8,p.span=p.max-p.min,N=!0),w>p.max-H&&(p.max+=p.span*.8,p.span=p.max-p.min,N=!0),N&&(P=!0)}let b=p.span*g;N&&(b=Math.max(b,p.span*.25));const I=b;let E=w+(Math.random()-.5)*2*I;E<p.min&&(E=p.min),E>p.max&&(E=p.max),_[R]=E});const k=c(_),M=k.mse-T;let L=!1;if(M<0)L=!0;else{const w=Math.exp(-M/(C+1e-9));Math.random()<w&&(L=!0)}if(L&&(A=_,T=k.mse),k.mse<a&&(a=k.mse,d={weights:k.weights,bias:k.bias,_array:[..._]}),u.push({params:[..._],error:k.mse,mae:k.mae}),u.length>=S){let w;P&&(w="Grenzen dynamisch erweitert..."),i&&i(u,{bestParams:d,minError:a,message:w}),u=[],await new Promise(R=>setTimeout(R,0))}}return u.length>0&&i&&i(u,{bestParams:d,minError:a}),{bestParams:d,minError:a}}}function Ce({history:e,currentStepIndex:t,isTraining:n,paramsConfig:i}){const l=ot(null);return mt(()=>{const r=l.current;if(!r||!e||e.length===0)return;const s=r.getContext("2d"),a=r.width,d=r.height;s.clearRect(0,0,a,d),s.fillStyle="#fff",s.fillRect(0,0,a,d);const h=Math.max(...e.map(y=>y.error)),c=!n&&e.length>0?e.length-1:t!==null&&t>=0?Math.min(t,e.length-1):-1;let v=-1,u=1/0;for(let y=0;y<=c;y++)e[y].error<u&&(u=e[y].error,v=y);let S=[];if(i){const y=i.length,W=y>=4?3:y,C=Math.ceil(y/W),g=a/W,P=d/C;S=i.map((_,o)=>{const k=e.map(p=>p.params[o]),M=Math.min(...k),L=Math.max(...k),w=o%W,R=Math.floor(o/W);return{xLabel:_.name,xMin:M,xMax:L,getValue:(p,N)=>p.params[o],offsetX:w*g,offsetY:R*P,w:g,h:P}})}else{const y=a/2,W=e.map(g=>g.weight),C=e.map(g=>g.bias);S=[{xLabel:"Weight",xMin:Math.min(...W),xMax:Math.max(...W),getValue:g=>g.weight,offsetX:0,offsetY:0,w:y,h:d},{xLabel:"Bias",xMin:Math.min(...C),xMax:Math.max(...C),getValue:g=>g.bias,offsetX:y,offsetY:0,w:y,h:d}]}const T=35;S.forEach(y=>{const{xLabel:W,xMin:C,xMax:g,getValue:P,offsetX:_,offsetY:o,w:k,h:M}=y,L=R=>o+M-T-R/(h||1)*(M-2*T),w=R=>_+T+(R-C)/(g-C||1)*(k-2*T);s.strokeStyle="#eee",s.strokeRect(_,o,k,M),s.beginPath(),s.strokeStyle="#333",s.lineWidth=1,s.moveTo(_+T,o+T),s.lineTo(_+T,o+M-T),s.lineTo(_+k-T,o+M-T),s.stroke(),s.fillStyle="#333",s.font="11px sans-serif",s.textAlign="center",s.fillText(W,_+k/2,o+M-10),_===0&&(s.save(),s.translate(_+10,o+M/2),s.rotate(-Math.PI/2),s.fillText("Error",0,0),s.restore()),s.fillStyle="#666",s.font="9px sans-serif",s.fillText(C.toFixed(1),_+T,o+M-T+12),s.fillText(g.toFixed(1),_+k-T,o+M-T+12),s.fillStyle="rgba(52, 152, 219, 0.4)";for(let R=0;R<=c;R++){const p=P(e[R],R),N=w(p),b=L(e[R].error);s.fillRect(N,b,2,2)}if(v>=0){const R=P(e[v],v),p=w(R),N=L(e[v].error);s.beginPath(),s.fillStyle="#2ecc71",s.strokeStyle="#27ae60",s.arc(p,N,6,0,Math.PI*2),s.fill(),s.stroke()}if(n&&t!==null&&t>=0&&t<=c){const R=P(e[t],t),p=w(R),N=L(e[t].error);s.beginPath(),s.fillStyle="#e74c3c",s.strokeStyle="#c0392b",s.arc(p,N,5,0,Math.PI*2),s.fill(),s.stroke()}});const A=a-120,m=10;s.fillStyle="rgba(255,255,255,0.8)",s.fillRect(A,m,110,50),s.strokeStyle="#ccc",s.strokeRect(A,m,110,50),s.textAlign="left",s.font="10px sans-serif",s.beginPath(),s.fillStyle="#e74c3c",s.arc(A+10,m+15,4,0,Math.PI*2),s.fill(),s.fillStyle="#333",s.fillText("Current Scan",A+20,m+18),s.beginPath(),s.fillStyle="#2ecc71",s.arc(A+10,m+35,4,0,Math.PI*2),s.fill(),s.fillStyle="#333",s.fillText("Best So Far",A+20,m+38),!n&&v>=0&&(s.fillStyle="#333",s.font="bold 12px sans-serif",s.textAlign="right",s.fillText(`Min Error: ${u.toFixed(5)}`,a-10,d-10))},[e,t,n,i]),f("div",{style:{border:"1px solid #ccc",borderRadius:"8px",padding:"10px",background:"#fff"},children:f("canvas",{ref:l,width:800,height:400,style:{width:"100%",height:"auto"}})})}function pe({input:e,weight:t,bias:n,output:i,formula:l="y = w * x + b",inputLabel:r="Input",outputLabel:s="Output",biasLabel:a="b"}){const d=Array.isArray(e)?e:[e],h=Array.isArray(t)?t:[t],x=Array.isArray(r)?r:[r],c=Number(n)||0,v=Number(i)||0,u=d.length,S=24,T=90,A=300,m=60,y=60,W=Math.max(1,u-1)*T,C=Math.max(150,W+m+y),g=C+60,P=600,_=P/2,o=_-A/2,k=_+A/2,M=C/2+20,L=M-W/2,w=k-50,R=w-60;return f("div",{style:{border:"1px solid #ccc",borderRadius:"8px",padding:"10px",background:"#fff",textAlign:"center"},children:[f("h3",{style:{marginBottom:"10px"},children:"Modell Architektur"}),f("svg",{width:P,height:g,style:{overflow:"visible"},children:[f("defs",{children:f("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"27",refY:"3.5",orient:"auto",children:f("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#333"})})}),f("rect",{x:o,y:20,width:A,height:C,rx:"15",fill:"none",stroke:"#333",strokeWidth:"3",strokeDasharray:"5,5"}),f("text",{x:_,y:40,textAnchor:"middle",fill:"#777",fontSize:"12",fontWeight:"bold",children:"NEURAL NETWORK"}),(()=>{const p=M-50;return f(ht,{children:[d.map((N,b)=>{const I=u>1?L+b*T:M,E=Number(h[b])||0,H=x[b]||`x${b+1}`,z=Number(N)||0;return f("g",{children:[f("line",{x1:o,y1:I,x2:R,y2:M,stroke:"#999",strokeWidth:"1"}),f("g",{transform:`translate(${(o+R)/2+(b-(u-1)/2)*5}, ${(I+M)/2})`,children:[f("rect",{x:"-24",y:"-9",width:"50",height:"18",fill:"#fff",rx:"4",stroke:"#e0e0e0"}),f("text",{x:"0",y:"4",textAnchor:"middle",fill:"#e74c3c",fontSize:"10",fontWeight:"bold",children:E.toFixed(1)})]}),f("circle",{cx:o,cy:I,r:S,fill:"#fff",stroke:"#333",strokeWidth:"2"}),f("text",{x:o-30,y:I,textAnchor:"end",style:{textAnchor:"end"},dominantBaseline:"middle",fontWeight:"bold",fontSize:"14",children:H}),f("text",{x:o-10,y:I+2,textAnchor:"middle",dominantBaseline:"middle",fontSize:"12",fill:"#333",children:z.toFixed(qt?.id==="spam"||qt?.id==="spam_advanced"?0:1)})]},b)}),f("line",{x1:R,y1:M,x2:w,y2:M,stroke:"#333",strokeWidth:"2"}),f("g",{transform:`translate(${w}, ${M})`,children:[f("rect",{x:"-18",y:"-18",width:"36",height:"36",rx:"6",fill:"#fff",stroke:"#333",strokeWidth:"2"}),f("path",{d:"M -10 8 C -4 8, -4 -8, 10 -8",stroke:"#333",strokeWidth:"2",fill:"none"})]}),f("line",{x1:w+18,y1:M,x2:k-S,y2:M,stroke:"#333",strokeWidth:"2"}),f("path",{d:`M ${w-20} ${p} Q ${w-20} ${M} ${R+10} ${M}`,fill:"none",stroke:"#f39c12",strokeWidth:"1",markerEnd:"url(#arrowhead)"}),f("circle",{cx:w-20,cy:p,r:12,fill:"#f1c40f",stroke:"#f39c12"}),f("text",{x:w-23,y:p+5,textAnchor:"middle",dominantBaseline:"middle",fontSize:"12",fontWeight:"bold",fill:"#fff",children:"b"}),f("text",{x:w-5,y:p+5,textAnchor:"start",dominantBaseline:"middle",fontSize:"12",fill:"#f39c12",fontWeight:"bold",children:c.toFixed(2)})]})})(),f("circle",{cx:k,cy:M,r:S,fill:"#fff",stroke:"#333",strokeWidth:"2"}),f("text",{x:k-14,y:M+4,textAnchor:"middle",dominantBaseline:"middle",fontWeight:"bold",fontSize:"12",children:v.toFixed(2)}),f("text",{x:k+40,y:M+4,textAnchor:"start",dominantBaseline:"middle",fontWeight:"bold",fontSize:"14",fill:"#333",children:s}),f("text",{x:_,y:g-15,textAnchor:"middle",fontSize:"12",fontStyle:"italic",fill:"#777",children:l})]})]})}const qt={};function Re({onGenerateData:e,onTrain:t,onRun:n,onReset:i,isTraining:l,trainingStep:r,dataCount:s,trainerType:a,onTrainerTypeChange:d}){return f("div",{role:"region","aria-label":"Steuerung",style:{padding:"20px",background:"#eee",borderRadius:"8px",display:"flex",gap:"10px",flexWrap:"wrap",alignItems:"center"},children:[f("button",{onClick:e,disabled:l,children:"1. Trainingsdaten Generieren"}),f("span",{"aria-live":"polite",children:["Datenpunkte: ",s]}),f("div",{style:{borderLeft:"1px solid #ccc",paddingLeft:"10px",marginLeft:"10px",display:"flex",gap:"5px",alignItems:"center"},children:[f("select",{value:a,onChange:h=>d(h.target.value),disabled:l,style:{padding:"8px",borderRadius:"4px",border:"1px solid #ccc"},children:[f("option",{value:"exhaustive",children:"Grid Search (Genau)"}),f("option",{value:"random",children:"Adaptive Random (Schnell)"})]}),f("button",{onClick:t,disabled:l||s===0,"aria-busy":l,children:l?"Suche läuft...":"2. Trainieren"})]}),f("button",{onClick:n,disabled:l,children:"3. Simulation Starten"}),f("button",{onClick:i,style:{marginLeft:"auto",background:"#e74c3c",color:"white"},"aria-label":"Simulation zurücksetzen",children:"Reset"})]})}function Ee(){const[e,t]=Z(0),n=[{name:"Simple Perceptron",input:.5,weight:.8,bias:.2,output:.6,inputLabel:"Input",formula:"y = w * x + b"},{name:"Spam Filter (2 Inputs)",input:[1,0],weight:[.5,-.2],bias:.1,output:.8,inputLabel:["Spam Word","Suspicious Link"],formula:"y = w1*x1 + w2*x2 + b"},{name:"Complex Model (5 Inputs)",input:[1,.5,-1,0,.2],weight:[.1,.2,.3,.4,.5],bias:-.5,output:.1,inputLabel:["F1","F2","F3","F4","F5"],formula:"y = Σ(wi*xi) + b"},{name:"Many Inputs (8 Inputs)",input:[1,0,1,0,1,0,1,0],weight:[.1,-.1,.1,-.1,.1,-.1,.1,-.1],bias:0,output:.5,inputLabel:["I1","I2","I3","I4","I5","I6","I7","I8"],formula:"y = ... "}],i=n[e];return f("div",{style:{padding:"20px"},children:[f("h2",{children:"Architecture Gallery"}),f("div",{style:{marginBottom:"20px"},children:[f("button",{onClick:()=>t((e-1+n.length)%n.length),children:"Previous"}),f("span",{style:{margin:"0 10px"},children:[i.name," (",e+1,"/",n.length,")"]}),f("button",{onClick:()=>t((e+1)%n.length),children:"Next"})]}),f("div",{style:{width:"400px",border:"1px dashed #ccc",padding:"10px"},children:f(pe,{input:i.input,weight:i.weight,bias:i.bias,output:i.output,formula:i.formula,inputLabel:i.inputLabel})})]})}class Le{constructor(t=30,n=50){this.velocity=t,this.initialPosition=n}getPosition(t){return this.velocity*t+this.initialPosition}}class Ie{constructor(){this.weight=0,this.bias=0}predict(t){return this.weight*t+this.bias}setWeight(t){this.weight=t}setBias(t){this.bias=t}}function $e({time:e,groundTruth:t,neuralNet:n,maxDistance:i=300}){const l=ot(null);mt(()=>{const s=l.current;if(!s)return;const a=s.getContext("2d"),d=s.width,h=s.height,x=50,c=d-2*x;a.clearRect(0,0,d,h);const v=t.getPosition(e),u=n.predict(e),S=x+v%i/i*c,T=x+u%i/i*c;a.fillStyle="#f0f0f0",a.fillRect(0,0,d,h/2),a.fillStyle="#e0e0e0",a.fillRect(0,h/2,d,h/2),a.beginPath(),a.strokeStyle="#fff",a.setLineDash([20,20]),a.moveTo(0,h/4),a.lineTo(d,h/4),a.moveTo(0,h*3/4),a.lineTo(d,h*3/4),a.stroke(),a.beginPath(),a.strokeStyle="#ccc",a.setLineDash([]),a.moveTo(x,0),a.lineTo(x,h),a.moveTo(d-x,0),a.lineTo(d-x,h),a.stroke(),r(a,S,h/4,"#2ecc71","Ground Truth"),r(a,T,h*3/4,"#e74c3c","Neural Net"),a.fillStyle="#333",a.font="14px monospace",a.fillText(`Zeit: ${e.toFixed(1)}s`,10,20),a.fillText(`Pos GT: ${v.toFixed(1)}m`,10,40),a.fillText(`Pos NN: ${u.toFixed(1)}m`,10,h/2+40)},[e,t,n,i]);function r(s,a,d,h,x){s.save(),s.translate(a,d),s.fillStyle=h,s.fillRect(-20,-10,40,20),s.fillStyle="#000",s.fillRect(-15,-15,10,5),s.fillRect(5,-15,10,5),s.fillRect(-15,10,10,5),s.fillRect(5,10,10,5),s.fillStyle="#000",s.font="10px sans-serif",s.textAlign="center",s.fillText(x,0,-20),s.restore()}return f("div",{style:{border:"2px solid #333",borderRadius:"8px",overflow:"hidden"},children:f("canvas",{ref:l,width:800,height:300,style:{width:"100%",display:"block"}})})}const Kt={id:"physics",title:"Phase 1: Lineare Regression (Exhaustive Search 2D)",description:"Physiksimulation: Weg-Zeit-Gesetz (s = v*t + s0)",Model:Ie,GroundTruth:Le,CanvasComponent:$e,defaultParams:{weight:0,bias:0},groundTruthDefaults:[30,50],getInput:e=>e,generateData:e=>Array.from({length:20},(n,i)=>i*.5).map(n=>({input:n,target:e.getPosition(n)})),trainingConfig:{weightRange:{min:0,max:60,step:1},biasRange:{min:0,max:100,step:2}},networkViz:{formula:"pos = w * t + b",inputLabel:"Zeit (t)",outputLabel:"Pos (m)",biasLabel:"b"}};class Ne{constructor(t=.5,n=-5){this.weight=t,this.bias=n}sigmoid(t){return 1/(1+Math.exp(-t))}classify(t){const n=this.sigmoid(this.weight*t+this.bias);return Math.random()<n?1:0}getProbability(t){return this.sigmoid(this.weight*t+this.bias)}}class Fe{constructor(){this.weight=0,this.bias=0}sigmoid(t){return 1/(1+Math.exp(-t))}predict(t){const n=this.weight*t+this.bias;return this.sigmoid(n)}setWeight(t){this.weight=t}setBias(t){this.bias=t}}function ze({time:e,groundTruth:t,neuralNet:n}){const i=ot(null);return mt(()=>{const l=i.current;if(!l)return;const r=l.getContext("2d"),s=l.width,a=l.height;r.clearRect(0,0,s,a);const d=40,h=s-2*d,x=a-2*d,c=0,v=20,u=g=>d+g/v*h,S=g=>a-d-g*x;r.beginPath(),r.strokeStyle="#eee";for(let g=0;g<=4;g++){const P=S(g*.25);r.moveTo(d,P),r.lineTo(s-d,P)}for(let g=0;g<=10;g++){const P=u(g*2);r.moveTo(P,d),r.lineTo(P,a-d)}r.stroke(),r.beginPath(),r.strokeStyle="#333",r.moveTo(d,d),r.lineTo(d,a-d),r.lineTo(s-d,a-d),r.stroke(),r.fillStyle="#333",r.textAlign="center",r.fillText("Anzahl 'Spam' Wörter",s/2,a-10),r.save(),r.translate(15,a/2),r.rotate(-Math.PI/2),r.fillText("Spam Wahrscheinlichkeit",0,0),r.restore();const T=(g,P,_=[])=>{r.beginPath(),r.strokeStyle=P,r.setLineDash(_),r.lineWidth=2;for(let o=c;o<=v;o+=.5){let k=0;typeof g.getProbability=="function"?k=g.getProbability(o):typeof g.predict=="function"&&(k=g.predict(o));const M=u(o),L=S(k);o===c?r.moveTo(M,L):r.lineTo(M,L)}r.stroke(),r.setLineDash([])};T(t,"#ccc",[5,5]),T(n,"#e74c3c");const m=Math.floor(e*2),y=50,W=g=>{const P=Math.sin(g*123.456)*1e4;return P-Math.floor(P)},C=Math.min(m,y);for(let g=0;g<C;g++){const P=W(g+1),_=Math.floor(P*21),o=t.getProbability(_),M=W(g+999)<o?1:0,L=u(_),w=S(M);r.beginPath();const R=(W(g+333)-.5)*10,p=(W(g+444)-.5)*10;r.arc(L+R,w+p,5,0,Math.PI*2),r.fillStyle=M?"#e74c3c":"#2ecc71",r.fill(),r.strokeStyle="#fff",r.stroke()}if(C>0&&C<=y){const g=C-1,P=W(g+1),_=Math.floor(P*21),o=t.getProbability(_),M=W(g+999)<o?1:0,L=(W(g+333)-.5)*10,w=(W(g+444)-.5)*10,R=u(_)+L,p=S(M)+w;r.beginPath(),r.arc(R,p,8,0,Math.PI*2),r.strokeStyle="#333",r.stroke(),r.fillStyle="#333",r.font="10px sans-serif",r.fillText(`${_}`,R,p-12)}},[e,t,n]),f("div",{className:"canvas-container",children:f("canvas",{ref:i,width:600,height:300,style:{width:"100%",border:"1px solid #ccc",background:"#fff"}})})}const He=e=>{const t=Math.sin(e)*1e4;return t-Math.floor(t)},Jt={id:"spam",title:"Phase 2: Logistische Regression (Spam Filter)",description:"Spam-Erkennung: Wahrscheinlichkeit p = σ(w*x + b)",Model:Fe,GroundTruth:Ne,CanvasComponent:ze,defaultParams:{weight:0,bias:0},groundTruthDefaults:[.5,-5],getInput:e=>{const t=Math.floor(e);return Math.floor(He(t)*20)},generateData:e=>{const t=[];for(let n=0;n<50;n++){const i=Math.floor(Math.random()*21),l=e.classify(i);t.push({input:i,target:l})}return t.sort((n,i)=>n.input-i.input)},trainingConfig:{weightRange:{min:0,max:2,step:.1},biasRange:{min:-10,max:5,step:.5}},networkViz:{formula:"p = σ(w * x + b)",inputLabel:"Wörter (x)",outputLabel:"Spam? (p)",biasLabel:"b"},isFinished:e=>e>=25};class De{constructor(t=[.5,.2,.8,-.1],n=-3){this.weights=t,this.bias=n}sigmoid(t){return 1/(1+Math.exp(-t))}classify(t){let n=this.bias;for(let l=0;l<this.weights.length;l++)n+=this.weights[l]*t[l];const i=this.sigmoid(n);return Math.random()<i?1:0}getProbability(t){let n=this.bias;for(let i=0;i<this.weights.length;i++)n+=this.weights[i]*t[i];return this.sigmoid(n)}}class Be{constructor(t=4){this.weights=new Array(t).fill(0),this.bias=0}sigmoid(t){return 1/(1+Math.exp(-t))}predict(t){let n=this.bias;for(let i=0;i<this.weights.length;i++)n+=this.weights[i]*t[i];return this.sigmoid(n)}setWeights(t){this.weights=[...t]}setBias(t){this.bias=t}setWeightAt(t,n){t>=0&&t<this.weights.length&&(this.weights[t]=n)}}const Q=[{label:"Spam Words",idx:0,max:15},{label:"Großbuchstaben",idx:1,max:25},{label:"Links",idx:2,max:8},{label:"Gesamtworte",idx:3,max:100}];function Ge({data:e,currentInput:t,currentPrediction:n,neuralNet:i}){const l=ot(null),[r,s]=Z("scatter"),[a,d]=Z(0),[h,x]=Z(3),[c,v]=Z(2),[u,S]=Z({x:-.5,y:.5}),T=ot(!1),A=ot({x:0,y:0}),[m,y]=Z(null),W=_=>{r==="3d"&&(T.current=!0,A.current={x:_.clientX,y:_.clientY})},C=_=>{if(T.current&&r==="3d"){const o=_.clientX-A.current.x,k=_.clientY-A.current.y;S(M=>({x:M.x+k*.01,y:M.y+o*.01})),A.current={x:_.clientX,y:_.clientY};return}if(r==="scatter"){const o=l.current;if(!o)return;const k=o.getBoundingClientRect(),M=_.clientX-k.left,L=_.clientY-k.top;let w=null;const R=10,p=50,N=o.width-2*p,b=o.height-2*p,I=p,E=o.height-p,H=Q[a].max,z=Q[h].max;if(e)for(const F of e){const G=I+F.input[a]/H*N,it=E-F.input[h]/z*b;if(Math.sqrt((G-M)**2+(it-L)**2)<R){w={x:G,y:it,text:F.text,isSpam:F.target===1};break}}y(w)}else y(null)},g=()=>{T.current=!1},P=()=>{y(null)};return mt(()=>{const _=l.current;if(!_)return;const o=_.getContext("2d"),k=_.width,M=_.height;o.clearRect(0,0,k,M),o.fillStyle="#fff",o.fillRect(0,0,k,M);const L=b=>{if(!e||e.length===0)return Q[b].max;const I=Math.max(...e.map(E=>E.input[b]));return I>0?I:Q[b].max};if(r==="3d"){const b=L(a),I=L(h),E=L(c),H=k/2,z=M/2,F=150,G=($,B,Y)=>{let K=$*Math.cos(u.y)-Y*Math.sin(u.y),O=$*Math.sin(u.y)+Y*Math.cos(u.y),lt=B*Math.cos(u.x)-O*Math.sin(u.x),dt=B*Math.sin(u.x)+O*Math.cos(u.x);const j=400/(400-dt);return{x:H+K*j,y:z+lt*j,z:dt}},q=[[-1,-1,-1],[1,-1,-1],[1,1,-1],[-1,1,-1],[-1,-1,1],[1,-1,1],[1,1,1],[-1,1,1]].map($=>G($[0]*F,$[1]*F,$[2]*F)),ft="#e29301ff",V="#2980b9",rt="#c00798ff",tt=($,B)=>{o.beginPath(),o.strokeStyle=B,o.lineWidth=1,$.forEach(([Y,K])=>{o.moveTo(q[Y].x,q[Y].y),o.lineTo(q[K].x,q[K].y)}),o.stroke()};tt([[0,1],[3,2],[4,5],[7,6]],ft),tt([[0,3],[1,2],[4,7],[5,6]],V),tt([[0,4],[1,5],[2,6],[3,7]],rt),o.font="bold 11px sans-serif",o.fillStyle=ft,o.fillText("X: "+Q[a].label,q[1].x,q[1].y),o.fillStyle=V,o.fillText("Y: "+Q[h].label,q[3].x,q[3].y),o.fillStyle=rt,o.fillText("Z: "+Q[c].label,q[4].x,q[4].y);const et=[],nt=($,B)=>$/B*2-1;if(i&&i.weights){const $=i.weights[a]||0,B=i.weights[h]||0,Y=i.weights[c]||0,K=i.bias||0;if(Math.abs(Y)>.001){o.strokeStyle="rgba(142, 68, 173, 0.3)",o.lineWidth=1;const O=(j,J)=>{const at=(j+1)/2*b,ct=(J+1)/2*I,me=(-$*at-B*ct-K)/Y;return nt(me,E)},lt=(j,J)=>{if(Math.abs(j.z)<=3&&Math.abs(J.z)<=3){const at=G(j.x*F,-j.y*F,j.z*F),ct=G(J.x*F,-J.y*F,J.z*F);o.beginPath(),o.moveTo(at.x,at.y),o.lineTo(ct.x,ct.y),o.stroke()}},dt=6;for(let j=0;j<=dt;j++){const J=-1+j/dt*2,at=O(-1,J),ct=O(1,J);lt({x:-1,y:J,z:at},{x:1,y:J,z:ct})}for(let j=0;j<=dt;j++){const J=-1+j/dt*2,at=O(J,-1),ct=O(J,1);lt({x:J,y:-1,z:at},{x:J,y:1,z:ct})}}}e&&e.forEach($=>{const B=nt($.input[a],b),Y=-nt($.input[h],I),K=nt($.input[c],E),O=G(B*F,Y*F,K*F);et.push({...O,color:$.target===1?"#e74c3c":"#2ecc71",radius:3})}),et.sort(($,B)=>$.z-B.z),et.forEach($=>{o.beginPath(),o.arc($.x,$.y,$.radius,0,Math.PI*2),o.fillStyle=$.color,o.fill(),$.border&&(o.strokeStyle="#fff",o.lineWidth=2,o.stroke())});return}if(r==="scatter"){const b=L(a),I=L(h),E=50,H=k-2*E,z=M-2*E,F=E,G=M-E,it="#c0392b",q="#2980b9";o.lineWidth=2,o.beginPath(),o.strokeStyle=it,o.moveTo(F,G),o.lineTo(F+H,G),o.stroke(),o.beginPath(),o.strokeStyle=q,o.moveTo(F,G),o.lineTo(F,G-z),o.stroke(),o.textAlign="center",o.font="bold 14px sans-serif",o.fillStyle=it,o.fillText(`${Q[a].label} (max: ${b})`,F+H/2,G+35),o.save(),o.translate(15,G-z/2),o.rotate(-Math.PI/2),o.fillStyle=q,o.fillText(`${Q[h].label} (max: ${I})`,0,0),o.restore();const ft=(V,rt,tt,et)=>{const nt=V[a],$=V[h],B=F+nt/b*H,Y=G-$/I*z;o.beginPath(),o.arc(B,Y,tt,0,2*Math.PI),o.fillStyle=rt,o.fill(),et&&(o.strokeStyle=et,o.lineWidth=2,o.stroke())};if(e&&e.forEach(V=>{ft(V.input,V.target===1?"#e74c3c":"#2ecc71",5,"#fff")}),i){let V=i.weights;const rt=i.bias||0;if(V){const tt=V[a]||0,et=V[h]||0,nt=rt,$=(Y,K)=>{const O=F+Y/b*H,lt=G-K/I*z;return{x:O,y:lt}};if(o.beginPath(),o.strokeStyle="#c0392b",o.strokeStyle="rgba(142, 68, 173, 0.8)",o.lineWidth=2,o.setLineDash([10,5]),Math.abs(et)>.001){const Y=lt=>(-tt*lt-nt)/et,K=$(0,Y(0)),O=$(b,Y(b));o.moveTo(K.x,K.y),o.lineTo(O.x,O.y)}else if(Math.abs(tt)>.001){const Y=-nt/tt,K=$(Y,0),O=$(Y,I);o.moveTo(K.x,K.y),o.lineTo(O.x,O.y)}o.stroke(),o.setLineDash([]),o.fillStyle="rgba(142, 68, 173, 1)",o.font="bold 12px monospace",o.textAlign="left";const B=`${tt.toFixed(2)}x + ${et.toFixed(2)}y + ${nt.toFixed(2)} = 0`;o.fillText(B,F+10,G-z-5)}}if(t&&ft(t,"#3498db",8,"#2980b9"),o.fillStyle="#666",o.textAlign="right",o.font="11px sans-serif",o.fillText("Rot=Spam, Grün=OK",k-10,20),m){o.save(),o.fillStyle="rgba(0,0,0,0.85)",o.strokeStyle="#fff";const V=m.text||"No Text",rt=m.isSpam?"SPAM":"HAM",tt=o.measureText(V),et=Math.max(tt.width,100)+20,nt=50;let $=m.x+15,B=m.y-15;$+et>k&&($=m.x-et-10),B+nt>M&&(B=m.y-nt-10),B<0&&(B=m.y+20),o.beginPath(),o.roundRect($,B,et,nt,5),o.fill(),o.lineWidth=1,o.stroke(),o.textBaseline="top",o.textAlign="left",o.font="bold 12px sans-serif",o.fillStyle=m.isSpam?"#e74c3c":"#2ecc71",o.fillText(rt,$+10,B+10),o.font="italic 11px sans-serif",o.fillStyle="#ddd",o.fillText(V,$+10,B+28),o.restore()}return}if(r==="text"){if(o.textAlign="center",o.textBaseline="middle",!t||!t.text){o.fillStyle="#999",o.font="20px sans-serif",o.fillText("Kein Text verfügbar",k/2,M/2);return}const b=n>.5,I=b?"#feeff0":"#effaf0";o.fillStyle=I,o.fillRect(0,0,k,M);const E=t.text;o.fillStyle="#333",o.font="24px serif";const H=E.split(" ");let z="";const F=35,G=k/2;let it=M/3;const q=k-100;for(let rt=0;rt<H.length;rt++){const tt=z+H[rt]+" ";o.measureText(tt).width>q&&rt>0?(o.fillText(z,G,it),z=H[rt]+" ",it+=F):z=tt}o.fillText(z,G,it),it+=60;const ft=t.groundTruth===1;o.font="bold 16px sans-serif",o.fillStyle="#555",o.fillText(`Wahrheit: ${ft?"SPAM":"HAM"}`,G,it),it+=30;const V=(n*100).toFixed(1);o.font="bold 20px sans-serif",o.fillStyle=b?"#c0392b":"#27ae60",o.fillText(`Vorhersage: ${b?"SPAM":"HAM"} (${V}%)`,G,it);return}const w=30,R=(k-3*w)/2,p=(M-3*w)/2;[{x:w,y:w,...Q[0]},{x:w+R+w,y:w,...Q[1]},{x:w,y:w+p+w,...Q[2]},{x:w+R+w,y:w+p+w,...Q[3]}].forEach(b=>{if(o.strokeStyle="#ccc",o.strokeRect(b.x,b.y,R,p),o.fillStyle="#333",o.font="12px Arial",o.textAlign="center",o.fillText(b.label,b.x+R/2,b.y-5),e&&e.forEach(I=>{const E=I.input[b.idx],H=b.x+E/b.max*R,z=b.y+p-I.target*(p-20)-10;o.beginPath(),o.arc(H,z,3,0,2*Math.PI),o.fillStyle=I.target?"rgba(231, 76, 60, 0.6)":"rgba(46, 204, 113, 0.6)",o.fill()}),t){const I=t[b.idx],E=b.x+I/b.max*R;o.beginPath(),o.moveTo(E,b.y),o.lineTo(E,b.y+p),o.strokeStyle="#3498db",o.setLineDash([5,5]),o.stroke(),o.setLineDash([])}})},[e,t,n,r,a,h,c,u]),f("div",{style:{textAlign:"center"},children:[f("div",{style:{marginBottom:"10px",display:"flex",gap:"5px",justifyContent:"center",flexWrap:"wrap",fontSize:"0.9rem"},children:[f("select",{value:r,onChange:_=>s(_.target.value),style:{padding:"4px"},children:[f("option",{value:"features",children:"Alle Features"}),f("option",{value:"scatter",children:"2D Plot"}),f("option",{value:"3d",children:"3D Plot"}),f("option",{value:"text",children:"Text Mode"})]}),(r==="scatter"||r==="3d")&&f(ht,{children:[f("span",{children:"X:"}),f("select",{value:a,onChange:_=>d(parseInt(_.target.value)),style:{padding:"4px"},children:Q.map(_=>f("option",{value:_.idx,children:_.label},_.idx))}),f("span",{children:"Y:"}),f("select",{value:h,onChange:_=>x(parseInt(_.target.value)),style:{padding:"4px"},children:Q.map(_=>f("option",{value:_.idx,children:_.label},_.idx))})]}),r==="3d"&&f(ht,{children:[f("span",{children:"Z:"}),f("select",{value:c,onChange:_=>v(parseInt(_.target.value)),style:{padding:"4px"},children:Q.map(_=>f("option",{value:_.idx,children:_.label},_.idx))})]})]}),f("canvas",{ref:l,width:600,height:400,style:{border:"1px solid #eee",maxWidth:"100%",borderRadius:"4px",cursor:r==="3d"?"grab":"default"},onMouseDown:W,onMouseMove:C,onMouseUp:g,onMouseLeave:g,onMouseOut:P}),f("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"5px"},children:r==="3d"?"Drag to rotate 3D view":"Wähle Achsen für die Visualisierung"})]})}const Qt=e=>{const t=Math.sin(e)*1e4;return t-Math.floor(t)},Pt=e=>{const t=["winner","won","gift card","urgent","rolex","viagra","cash","prize","singles","marketing","buy","free","money","security alert","click","claim","fake","verification"],n=e.toLowerCase();let i=0;t.forEach(a=>{n.includes(a)&&(i+=1)}),i>10&&(i=10);const l=(e.match(/[A-Z]/g)||[]).length,r=(e.match(/http/g)||[]).length,s=e.split(/\s+/).length;return[i,l,r,s]},_t={id:"spam_advanced",title:"Phase 3: Erweiterter Spam-Filter (4 Eingaben)",description:"Spam-Erkennung mit 4 Merkmalen: Spam-Worte, Großbuchstaben, Links, Gesamtworte.",Model:Be,GroundTruth:De,CanvasComponent:Ge,defaultParams:{weights:[0,0,0,0],bias:0},groundTruthDefaults:[[1.5,.5,2,-.5],-5],getInput:e=>{const t=Math.floor(e*.3),n=Qt(t)>.5,i=n?_t.examples.spam:_t.examples.ham,l=Math.floor(Qt(t+99)*i.length),r=i[l],s=Pt(r);return s.text=r,s.groundTruth=n?1:0,s},examples:{spam:["WINNER! Won $1000 Gift Card! Claim at http://prize-giveaway.net","URGENT: Verify account at http://secure-bank-login.com/fraud","Cheap Rolex watches! 50% OFF at www.fake-watches.cn","Lose weight fast! Buy pills: http://diet-miracle.com","CONGRATS! Cash prize waiting: http://claim-money.org","HOT singles waiting! Chat now: http://local-dating.xyz","Refinance 1% APR. Apply: http://easy-loans.biz","Buy 1 get 1 FREE Viagra. http://meds-direct.com","Meet rich men. Signup: http://millionaire-match.com","SECURITY ALERT: Suspicious activity. Check http://account-security-check.com"],ham:["Meeting agenda for tomorrow's team sync","Hey, are we still on for lunch?","Invoice #12345 from AWS Services","Project deadline extended to Friday","Happy Birthday! Hope you have a great day.","Can you review this pull request?","Your Amazon order has shipped.","Fwd: Tickets for the concert","Question about the quarterly report","Let's catch up sometime next week."]},generateData:e=>{const t=[];_t.examples.spam.forEach(n=>{const i=Pt(n),l=()=>(Math.random()-.5)*.1,r=i.map(s=>Math.max(0,s+l()));t.push({input:r,target:1,text:n})}),_t.examples.ham.forEach(n=>{const l=Pt(n).map(r=>Math.max(0,r+(Math.random()-.5)*.1));t.push({input:l,target:0,text:n})});for(let n=t.length-1;n>0;n--){const i=Math.floor(Math.random()*(n+1));[t[n],t[i]]=[t[i],t[n]]}return t},trainingConfig:{params:[{name:"w1 (Spam-Worte)",min:1,max:4,step:.5},{name:"w2 (Großbuchst.)",min:0,max:2,step:.5},{name:"w3 (Links)",min:0,max:3,step:.5},{name:"w4 (Gesamtworte)",min:-2,max:2,step:.5},{name:"bias",min:-8,max:8,step:2}]},networkViz:{formula:"p = σ(w₁x₁ + w₂x₂ + w₃x₃ + w₄x₄ + b)",inputLabels:["Spam-Worte","Großbuchst.","Links","Gesamtworte"],outputLabel:"Spam? (p)",biasLabel:"b"},isFinished:e=>e>=50},te={[Kt.id]:Kt,[Jt.id]:Jt,[_t.id]:_t};function Xe(e){return te[e]||te.physics}function Ye(){const[e,t]=Z(null),n=ot(null),i=ot(null),[l,r]=Z(0),[s,a]=Z(!1),[d,h]=Z([]),[x,c]=Z([]),[v,u]=Z(-1),[S,T]=Z(!1),[A,m]=Z("simulation"),[y,W]=Z("exhaustive"),[C,g]=Z("Bereit."),P=ot(0);mt(()=>{const N=new URLSearchParams(window.location.search).get("sim")||"physics";if(N==="gallery"){t({id:"gallery",type:"gallery"});return}const b=Xe(N);if(!b){g("Fehler: Simulation nicht gefunden.");return}try{n.current=new b.GroundTruth(...b.groundTruthDefaults||[]),i.current=new b.Model,b.defaultParams&&(b.defaultParams.weight!==void 0&&i.current.setWeight(b.defaultParams.weight),b.defaultParams.weights!==void 0&&i.current.setWeights&&i.current.setWeights(b.defaultParams.weights),b.defaultParams.bias!==void 0&&i.current.setBias(b.defaultParams.bias)),t(b)}catch(I){console.error("Initialization Error:",I),g(`Init Fehler: ${I.message}`)}},[]),mt(()=>{let p;const N=b=>{if(!s)return;P.current===0&&(P.current=b);const I=(b-P.current)/1e3;P.current=b;const E=Math.min(I,.1);r(H=>{const F=H+E*3;return e&&e.isFinished&&e.isFinished(F)&&(a(!1),g("Simulation beendet.")),F}),p=requestAnimationFrame(N)};return s&&(P.current=0,p=requestAnimationFrame(N)),()=>cancelAnimationFrame(p)},[s,e]);const _=()=>{try{if(!e)return;if(!n.current)throw new Error("Ground Truth not initialized");const p=e.generateData(n.current);h(p),g(`${p.length} Trainingsdaten generiert.`),m("data")}catch(p){console.error("Generate Data Error:",p),g(`Fehler beim Generieren: ${p.message}`)}},o=async()=>{try{if(d.length===0||!e)return;T(!0),u(0),c([]),g("Suche optimales Gewicht und Bias (Live Visualisierung)..."),m("training");const p=new We(i.current),N=(I,E)=>{if(c(H=>{const z=[...H,...I];return u(z.length-1),z}),(E&&E.message||E&&E.message)&&g(E.message),E&&E.bestParams){if(i.current.setWeights){const{weights:H,bias:z}=E.bestParams;i.current.setWeights(H),i.current.setBias(z)}}else E&&E.bestWeight!==void 0&&(i.current.setWeight(E.bestWeight),i.current.setBias(E.bestBias))};let b;y==="random"?(g("Suche optimales Gewicht und Bias (Random Search)..."),b=await p.trainRandomAsync(d,e.trainingConfig.params,N)):e.trainingConfig.params?b=await p.trainAsync(d,e.trainingConfig.params,N):b=await p.trainAsync(d,e.trainingConfig.weightRange,e.trainingConfig.biasRange,N),g(`Training fertig! Min Error: ${b.minError.toFixed(5)}`),T(!1)}catch(p){console.error("Training Error:",p),T(!1),g(`Fehler beim Training: ${p.message}`)}},k=()=>{r(0),a(!0),g("Simulation läuft..."),m("simulation")},M=()=>{a(!1),r(0),h([]),c([]),u(-1);try{i.current&&e?.defaultParams&&(e.defaultParams.weight!==void 0&&i.current.setWeight(e.defaultParams.weight),e.defaultParams.weights!==void 0&&i.current.setWeights&&i.current.setWeights(e.defaultParams.weights),e.defaultParams.bias!==void 0&&i.current.setBias(e.defaultParams.bias))}catch(p){console.error("Reset Error:",p)}g("Reset durchgeführt.")};if(!e)return f("div",{children:"Lade Simulation..."});if(e.type==="gallery")return f("div",{className:"container",children:[f("header",{children:[f("h1",{children:"Neural Network Demonstrator"}),f("p",{children:"Architecture Gallery (Debug)"}),f("div",{className:"sim-selector",style:{fontSize:"0.8rem",marginTop:"5px"},children:f("a",{href:"?sim=physics",style:{marginRight:"10px"},children:"Back to App"})})]}),f("main",{children:f(Ee,{})})]});const L=e.CanvasComponent,w=e.networkViz||{},R=e.getInput?e.getInput(l):l;return f("div",{className:"container",children:[f("header",{children:[f("h1",{children:"Neural Network Demonstrator"}),f("p",{children:e.title}),f("div",{className:"sim-selector",style:{fontSize:"0.8rem",marginTop:"5px"},children:[f("a",{href:"?sim=physics",style:{marginRight:"10px",fontWeight:e.id==="physics"?"bold":"normal"},children:"Phase 1 (Physik)"}),f("a",{href:"?sim=spam",style:{marginRight:"10px",fontWeight:e.id==="spam"?"bold":"normal"},children:"Phase 2 (Spam)"}),f("a",{href:"?sim=spam_advanced",style:{fontWeight:e.id==="spam_advanced"?"bold":"normal"},children:"Phase 3 (Spam Extended)"})]})]}),f("main",{children:[f("div",{className:"top-section",style:{display:"flex",gap:"20px",flexWrap:"wrap",alignItems:"start"},children:[f("div",{className:"simulation-wrapper",style:{flex:"1 1 500px"},children:f("div",{className:"simulation-section",children:[f("div",{className:"tabs",children:[f("button",{className:`tab-button ${A==="simulation"?"active":""}`,onClick:()=>m("simulation"),children:"Simulation"}),f("button",{className:`tab-button ${A==="data"?"active":""}`,onClick:()=>m("data"),children:"Trainingsdaten"}),f("button",{className:`tab-button ${A==="training"?"active":""}`,onClick:()=>m("training"),children:"Training"})]}),A==="simulation"&&f(ht,{children:[(()=>{let p=0;try{i.current&&(p=i.current.predict(R))}catch(N){console.error("Predict Error",N)}return f(L,{time:l,data:d,currentInput:R,currentPrediction:p,groundTruth:n.current,neuralNet:i.current})})(),f("div",{className:"stats",style:{marginTop:"10px"},children:[f("p",{children:e.description}),f("p",{style:{color:"#646cff",fontWeight:"bold"},children:["Status: ",C]})]})]}),A==="data"&&f("div",{className:"data-content",children:d.length>0?f("div",{style:{maxHeight:"400px",overflowY:"auto"},children:f("table",{style:{width:"100%",textAlign:"left",borderCollapse:"collapse",fontSize:"0.9rem"},children:[f("thead",{children:f("tr",{style:{background:"#eee",borderBottom:"2px solid #ddd"},children:[Array.isArray(w.inputLabels)?w.inputLabels.map((p,N)=>f("th",{style:{padding:"8px"},children:p},N)):f("th",{style:{padding:"8px"},children:["Input (",w.inputLabel,")"]}),f("th",{style:{padding:"8px"},children:"Target"}),d.length>0&&d[0].text&&f("th",{style:{padding:"8px"},children:"E-Mail Text"})]})}),f("tbody",{children:d.map((p,N)=>{const b=["spam","spam_advanced"].includes(e.id);let I="transparent",E=p.target,H={padding:"8px"};if(b){const z=p.target===1;I=z?"#ffebee":"#e8f5e9",E=z?"SPAM":"HAM",H={...H,fontWeight:"bold",color:z?"#c0392b":"#27ae60"}}else E=typeof p.target=="number"?p.target.toFixed(2):p.target;return f("tr",{style:{background:I,borderBottom:"1px solid #ddd"},children:[Array.isArray(p.input)?p.input.map((z,F)=>f("td",{style:{padding:"8px"},children:z.toFixed(0)},F)):f("td",{style:{padding:"8px"},children:p.input.toFixed(2)}),f("td",{style:H,children:E}),p.text&&f("td",{style:{padding:"8px",color:"#555",fontStyle:"italic",maxWidth:"300px"},children:p.text})]},N)})})]})}):f("p",{style:{padding:"20px",textAlign:"center",color:"#666"},children:"Noch keine Trainingsdaten generiert."})}),A==="training"&&f("div",{className:"training-content",children:x.length>0?f(Ce,{history:x,currentStepIndex:v,isTraining:S,paramsConfig:e.trainingConfig.params}):f("p",{style:{padding:"20px",textAlign:"center",color:"#666"},children:"Noch kein Training gestartet."})})]})}),f("div",{className:"network-wrapper",style:{flex:"0 0 350px"},children:f(pe,{input:R,weight:i.current?i.current.weights||i.current.weight:0,bias:i.current?i.current.bias:0,output:i.current?i.current.predict(R):0,formula:w.formula,inputLabel:w.inputLabels||w.inputLabel,outputLabel:w.outputLabel,biasLabel:w.biasLabel})})]}),f(Re,{onGenerateData:_,onTrain:o,onRun:k,onReset:M,isTraining:S,trainingStep:v,dataCount:d.length,trainerType:y,onTrainerTypeChange:W})]})]})}Se(f(Ye,{}),document.getElementById("app"));
