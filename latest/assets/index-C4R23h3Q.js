(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(a){if(a.ep)return;a.ep=!0;const o=n(a);fetch(a.href,o)}})();var Mt,I,te,ut,It,ee,ne,ie,Lt,Wt,Ct,gt={},oe=[],pe=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,kt=Array.isArray;function rt(e,t){for(var n in t)e[n]=t[n];return e}function $t(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function me(e,t,n){var i,a,o,r={};for(o in t)o=="key"?i=t[o]:o=="ref"?a=t[o]:r[o]=t[o];if(arguments.length>2&&(r.children=arguments.length>3?Mt.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(o in e.defaultProps)r[o]===void 0&&(r[o]=e.defaultProps[o]);return bt(e,r,i,a,null)}function bt(e,t,n,i,a){var o={type:e,props:t,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:a??++te,__i:-1,__u:0};return a==null&&I.vnode!=null&&I.vnode(o),o}function _t(e){return e.children}function vt(e,t){this.props=e,this.context=t}function pt(e,t){if(t==null)return e.__?pt(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?pt(e):null}function re(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return re(e)}}function Ht(e){(!e.__d&&(e.__d=!0)&&ut.push(e)&&!St.__r++||It!=I.debounceRendering)&&((It=I.debounceRendering)||ee)(St)}function St(){for(var e,t,n,i,a,o,r,l=1;ut.length;)ut.length>l&&ut.sort(ne),e=ut.shift(),l=ut.length,e.__d&&(n=void 0,i=void 0,a=(i=(t=e).__v).__e,o=[],r=[],t.__P&&((n=rt({},i)).__v=i.__v+1,I.vnode&&I.vnode(n),zt(t.__P,n,i,t.__n,t.__P.namespaceURI,32&i.__u?[a]:null,o,a??pt(i),!!(32&i.__u),r),n.__v=i.__v,n.__.__k[n.__i]=n,le(o,n,r),i.__e=i.__=null,n.__e!=a&&re(n)));St.__r=0}function se(e,t,n,i,a,o,r,l,u,h,g){var c,v,d,S,T,b,p,x=i&&i.__k||oe,P=t.length;for(u=ge(n,t,x,u,P),c=0;c<P;c++)(d=n.__k[c])!=null&&(v=d.__i==-1?gt:x[d.__i]||gt,d.__i=c,b=zt(e,d,v,a,o,r,l,u,h,g),S=d.__e,d.ref&&v.ref!=d.ref&&(v.ref&&Nt(v.ref,null,d),g.push(d.ref,d.__c||S,d)),T==null&&S!=null&&(T=S),(p=!!(4&d.__u))||v.__k===d.__k?u=ae(d,u,e,p):typeof d.type=="function"&&b!==void 0?u=b:S&&(u=S.nextSibling),d.__u&=-7);return n.__e=T,u}function ge(e,t,n,i,a){var o,r,l,u,h,g=n.length,c=g,v=0;for(e.__k=new Array(a),o=0;o<a;o++)(r=t[o])!=null&&typeof r!="boolean"&&typeof r!="function"?(typeof r=="string"||typeof r=="number"||typeof r=="bigint"||r.constructor==String?r=e.__k[o]=bt(null,r,null,null,null):kt(r)?r=e.__k[o]=bt(_t,{children:r},null,null,null):r.constructor==null&&r.__b>0?r=e.__k[o]=bt(r.type,r.props,r.key,r.ref?r.ref:null,r.__v):e.__k[o]=r,u=o+v,r.__=e,r.__b=e.__b+1,l=null,(h=r.__i=xe(r,n,u,c))!=-1&&(c--,(l=n[h])&&(l.__u|=2)),l==null||l.__v==null?(h==-1&&(a>g?v--:a<g&&v++),typeof r.type!="function"&&(r.__u|=4)):h!=u&&(h==u-1?v--:h==u+1?v++:(h>u?v--:v++,r.__u|=4))):e.__k[o]=null;if(c)for(o=0;o<g;o++)(l=n[o])!=null&&(2&l.__u)==0&&(l.__e==i&&(i=pt(l)),he(l,l));return i}function ae(e,t,n,i){var a,o;if(typeof e.type=="function"){for(a=e.__k,o=0;a&&o<a.length;o++)a[o]&&(a[o].__=e,t=ae(a[o],t,n,i));return t}e.__e!=t&&(i&&(t&&e.type&&!t.parentNode&&(t=pt(e)),n.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function xe(e,t,n,i){var a,o,r,l=e.key,u=e.type,h=t[n],g=h!=null&&(2&h.__u)==0;if(h===null&&l==null||g&&l==h.key&&u==h.type)return n;if(i>(g?1:0)){for(a=n-1,o=n+1;a>=0||o<t.length;)if((h=t[r=a>=0?a--:o++])!=null&&(2&h.__u)==0&&l==h.key&&u==h.type)return r}return-1}function Dt(e,t,n){t[0]=="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||pe.test(t)?n:n+"px"}function yt(e,t,n,i,a){var o,r;t:if(t=="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof i=="string"&&(e.style.cssText=i=""),i)for(t in i)n&&t in n||Dt(e.style,t,"");if(n)for(t in n)i&&n[t]==i[t]||Dt(e.style,t,n[t])}else if(t[0]=="o"&&t[1]=="n")o=t!=(t=t.replace(ie,"$1")),r=t.toLowerCase(),t=r in e||t=="onFocusOut"||t=="onFocusIn"?r.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+o]=n,n?i?n.u=i.u:(n.u=Lt,e.addEventListener(t,o?Ct:Wt,o)):e.removeEventListener(t,o?Ct:Wt,o);else{if(a=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=n??"";break t}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&n==1?"":n))}}function Xt(e){return function(t){if(this.l){var n=this.l[t.type+e];if(t.t==null)t.t=Lt++;else if(t.t<n.u)return;return n(I.event?I.event(t):t)}}}function zt(e,t,n,i,a,o,r,l,u,h){var g,c,v,d,S,T,b,p,x,P,C,m,M,_,s,A,W,L=t.type;if(t.constructor!=null)return null;128&n.__u&&(u=!!(32&n.__u),o=[l=t.__e=n.__e]),(g=I.__b)&&g(t);t:if(typeof L=="function")try{if(p=t.props,x="prototype"in L&&L.prototype.render,P=(g=L.contextType)&&i[g.__c],C=g?P?P.props.value:g.__:i,n.__c?b=(c=t.__c=n.__c).__=c.__E:(x?t.__c=c=new L(p,C):(t.__c=c=new vt(p,C),c.constructor=L,c.render=be),P&&P.sub(c),c.state||(c.state={}),c.__n=i,v=c.__d=!0,c.__h=[],c._sb=[]),x&&c.__s==null&&(c.__s=c.state),x&&L.getDerivedStateFromProps!=null&&(c.__s==c.state&&(c.__s=rt({},c.__s)),rt(c.__s,L.getDerivedStateFromProps(p,c.__s))),d=c.props,S=c.state,c.__v=t,v)x&&L.getDerivedStateFromProps==null&&c.componentWillMount!=null&&c.componentWillMount(),x&&c.componentDidMount!=null&&c.__h.push(c.componentDidMount);else{if(x&&L.getDerivedStateFromProps==null&&p!==d&&c.componentWillReceiveProps!=null&&c.componentWillReceiveProps(p,C),t.__v==n.__v||!c.__e&&c.shouldComponentUpdate!=null&&c.shouldComponentUpdate(p,c.__s,C)===!1){for(t.__v!=n.__v&&(c.props=p,c.state=c.__s,c.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function(k){k&&(k.__=t)}),m=0;m<c._sb.length;m++)c.__h.push(c._sb[m]);c._sb=[],c.__h.length&&r.push(c);break t}c.componentWillUpdate!=null&&c.componentWillUpdate(p,c.__s,C),x&&c.componentDidUpdate!=null&&c.__h.push(function(){c.componentDidUpdate(d,S,T)})}if(c.context=C,c.props=p,c.__P=e,c.__e=!1,M=I.__r,_=0,x){for(c.state=c.__s,c.__d=!1,M&&M(t),g=c.render(c.props,c.state,c.context),s=0;s<c._sb.length;s++)c.__h.push(c._sb[s]);c._sb=[]}else do c.__d=!1,M&&M(t),g=c.render(c.props,c.state,c.context),c.state=c.__s;while(c.__d&&++_<25);c.state=c.__s,c.getChildContext!=null&&(i=rt(rt({},i),c.getChildContext())),x&&!v&&c.getSnapshotBeforeUpdate!=null&&(T=c.getSnapshotBeforeUpdate(d,S)),A=g,g!=null&&g.type===_t&&g.key==null&&(A=ce(g.props.children)),l=se(e,kt(A)?A:[A],t,n,i,a,o,r,l,u,h),c.base=t.__e,t.__u&=-161,c.__h.length&&r.push(c),b&&(c.__E=c.__=null)}catch(k){if(t.__v=null,u||o!=null)if(k.then){for(t.__u|=u?160:128;l&&l.nodeType==8&&l.nextSibling;)l=l.nextSibling;o[o.indexOf(l)]=null,t.__e=l}else{for(W=o.length;W--;)$t(o[W]);Rt(t)}else t.__e=n.__e,t.__k=n.__k,k.then||Rt(t);I.__e(k,t,n)}else o==null&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):l=t.__e=ye(n.__e,t,n,i,a,o,r,u,h);return(g=I.diffed)&&g(t),128&t.__u?void 0:l}function Rt(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(Rt)}function le(e,t,n){for(var i=0;i<n.length;i++)Nt(n[i],n[++i],n[++i]);I.__c&&I.__c(t,e),e.some(function(a){try{e=a.__h,a.__h=[],e.some(function(o){o.call(a)})}catch(o){I.__e(o,a.__v)}})}function ce(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:kt(e)?e.map(ce):rt({},e)}function ye(e,t,n,i,a,o,r,l,u){var h,g,c,v,d,S,T,b=n.props||gt,p=t.props,x=t.type;if(x=="svg"?a="http://www.w3.org/2000/svg":x=="math"?a="http://www.w3.org/1998/Math/MathML":a||(a="http://www.w3.org/1999/xhtml"),o!=null){for(h=0;h<o.length;h++)if((d=o[h])&&"setAttribute"in d==!!x&&(x?d.localName==x:d.nodeType==3)){e=d,o[h]=null;break}}if(e==null){if(x==null)return document.createTextNode(p);e=document.createElementNS(a,x,p.is&&p),l&&(I.__m&&I.__m(t,o),l=!1),o=null}if(x==null)b===p||l&&e.data==p||(e.data=p);else{if(o=o&&Mt.call(e.childNodes),!l&&o!=null)for(b={},h=0;h<e.attributes.length;h++)b[(d=e.attributes[h]).name]=d.value;for(h in b)if(d=b[h],h!="children"){if(h=="dangerouslySetInnerHTML")c=d;else if(!(h in p)){if(h=="value"&&"defaultValue"in p||h=="checked"&&"defaultChecked"in p)continue;yt(e,h,null,d,a)}}for(h in p)d=p[h],h=="children"?v=d:h=="dangerouslySetInnerHTML"?g=d:h=="value"?S=d:h=="checked"?T=d:l&&typeof d!="function"||b[h]===d||yt(e,h,d,b[h],a);if(g)l||c&&(g.__html==c.__html||g.__html==e.innerHTML)||(e.innerHTML=g.__html),t.__k=[];else if(c&&(e.innerHTML=""),se(t.type=="template"?e.content:e,kt(v)?v:[v],t,n,i,x=="foreignObject"?"http://www.w3.org/1999/xhtml":a,o,r,o?o[0]:n.__k&&pt(n,0),l,u),o!=null)for(h=o.length;h--;)$t(o[h]);l||(h="value",x=="progress"&&S==null?e.removeAttribute("value"):S!=null&&(S!==e[h]||x=="progress"&&!S||x=="option"&&S!=b[h])&&yt(e,h,S,b[h],a),h="checked",T!=null&&T!=e[h]&&yt(e,h,T,b[h],a))}return e}function Nt(e,t,n){try{if(typeof e=="function"){var i=typeof e.__u=="function";i&&e.__u(),i&&t==null||(e.__u=e(t))}else e.current=t}catch(a){I.__e(a,n)}}function he(e,t,n){var i,a;if(I.unmount&&I.unmount(e),(i=e.ref)&&(i.current&&i.current!=e.__e||Nt(i,null,t)),(i=e.__c)!=null){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(o){I.__e(o,t)}i.base=i.__P=null}if(i=e.__k)for(a=0;a<i.length;a++)i[a]&&he(i[a],t,n||typeof e.type!="function");n||$t(e.__e),e.__c=e.__=e.__e=void 0}function be(e,t,n){return this.constructor(e,n)}function ve(e,t,n){var i,a,o,r;t==document&&(t=document.documentElement),I.__&&I.__(e,t),a=(i=!1)?null:t.__k,o=[],r=[],zt(t,e=t.__k=me(_t,null,[e]),a||gt,gt,t.namespaceURI,a?null:t.firstChild?Mt.call(t.childNodes):null,o,a?a.__e:t.firstChild,i,r),le(o,e,r)}Mt=oe.slice,I={__e:function(e,t,n,i){for(var a,o,r;t=t.__;)if((a=t.__c)&&!a.__)try{if((o=a.constructor)&&o.getDerivedStateFromError!=null&&(a.setState(o.getDerivedStateFromError(e)),r=a.__d),a.componentDidCatch!=null&&(a.componentDidCatch(e,i||{}),r=a.__d),r)return a.__E=a}catch(l){e=l}throw e}},te=0,vt.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=rt({},this.state),typeof e=="function"&&(e=e(rt({},n),this.props)),e&&rt(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),Ht(this))},vt.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),Ht(this))},vt.prototype.render=_t,ut=[],ee=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ne=function(e,t){return e.__v.__b-t.__v.__b},St.__r=0,ie=/(PointerCapture)$|Capture$/i,Lt=0,Wt=Xt(!1),Ct=Xt(!0);var we=0;function f(e,t,n,i,a,o){t||(t={});var r,l,u=t;if("ref"in u)for(l in u={},t)l=="ref"?r=t[l]:u[l]=t[l];var h={type:e,props:u,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--we,__i:-1,__u:0,__source:a,__self:o};if(typeof e=="function"&&(r=e.defaultProps))for(l in r)u[l]===void 0&&(u[l]=r[l]);return I.vnode&&I.vnode(h),h}var xt,G,At,Bt,Tt=0,fe=[],V=I,Gt=V.__b,Yt=V.__r,Vt=V.diffed,Ut=V.__c,Ot=V.unmount,jt=V.__;function Ft(e,t){V.__h&&V.__h(G,e,Tt||t),Tt=0;var n=G.__H||(G.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function Q(e){return Tt=1,Se(de,e)}function Se(e,t,n){var i=Ft(xt++,2);if(i.t=e,!i.__c&&(i.__=[de(void 0,t),function(l){var u=i.__N?i.__N[0]:i.__[0],h=i.t(u,l);u!==h&&(i.__N=[h,i.__[1]],i.__c.setState({}))}],i.__c=G,!G.__f)){var a=function(l,u,h){if(!i.__c.__H)return!0;var g=i.__c.__H.__.filter(function(v){return!!v.__c});if(g.every(function(v){return!v.__N}))return!o||o.call(this,l,u,h);var c=i.__c.props!==l;return g.forEach(function(v){if(v.__N){var d=v.__[0];v.__=v.__N,v.__N=void 0,d!==v.__[0]&&(c=!0)}}),o&&o.call(this,l,u,h)||c};G.__f=!0;var o=G.shouldComponentUpdate,r=G.componentWillUpdate;G.componentWillUpdate=function(l,u,h){if(this.__e){var g=o;o=void 0,a(l,u,h),o=g}r&&r.call(this,l,u,h)},G.shouldComponentUpdate=a}return i.__N||i.__}function mt(e,t){var n=Ft(xt++,3);!V.__s&&ue(n.__H,t)&&(n.__=e,n.u=t,G.__H.__h.push(n))}function st(e){return Tt=5,Te(function(){return{current:e}},[])}function Te(e,t){var n=Ft(xt++,7);return ue(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function Me(){for(var e;e=fe.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(wt),e.__H.__h.forEach(Et),e.__H.__h=[]}catch(t){e.__H.__h=[],V.__e(t,e.__v)}}V.__b=function(e){G=null,Gt&&Gt(e)},V.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),jt&&jt(e,t)},V.__r=function(e){Yt&&Yt(e),xt=0;var t=(G=e.__c).__H;t&&(At===G?(t.__h=[],G.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(t.__h.forEach(wt),t.__h.forEach(Et),t.__h=[],xt=0)),At=G},V.diffed=function(e){Vt&&Vt(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(fe.push(t)!==1&&Bt===V.requestAnimationFrame||((Bt=V.requestAnimationFrame)||ke)(Me)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),At=G=null},V.__c=function(e,t){t.some(function(n){try{n.__h.forEach(wt),n.__h=n.__h.filter(function(i){return!i.__||Et(i)})}catch(i){t.some(function(a){a.__h&&(a.__h=[])}),t=[],V.__e(i,n.__v)}}),Ut&&Ut(e,t)},V.unmount=function(e){Ot&&Ot(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(i){try{wt(i)}catch(a){t=a}}),n.__H=void 0,t&&V.__e(t,n.__v))};var Zt=typeof requestAnimationFrame=="function";function ke(e){var t,n=function(){clearTimeout(i),Zt&&cancelAnimationFrame(t),setTimeout(e)},i=setTimeout(n,35);Zt&&(t=requestAnimationFrame(n))}function wt(e){var t=G,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),G=t}function Et(e){var t=G;e.__c=e.__(),G=t}function ue(e,t){return!e||e.length!==t.length||t.some(function(n,i){return n!==e[i]})}function de(e,t){return typeof t=="function"?t(e):t}class Ae{constructor(t){this.model=t}train(t,n,i){if(i!==void 0)return this.trainLegacy(t,n,i);const a=n,o=[];let r=1/0,l={};const u=g=>{const c=[];if(g.step<=0)return[g.min];for(let v=g.min;v<=g.max+1e-4;v+=g.step)c.push(parseFloat(v.toFixed(2)));return c},h=(g,c)=>{if(console.log({paramIndex:g,currentParams:c}),g===a.length){const S=[];let T=0;c.forEach((C,m)=>{a[m].name.toLowerCase().includes("bias")?T=C:S.push(C)}),this.model.setWeights?this.model.setWeights(S):this.model.setWeight&&this.model.setWeight(S[0]),this.model.setBias(T);let b=0,p=0;for(const C of t){const m=this.model.predict(C.input),M=C.target-m;b+=M*M,p+=Math.abs(M)}const x=b/t.length,P=p/t.length;x<r&&(r=x,l={weights:[...S],bias:T}),o.push({params:[...c],error:x,mae:P});return}const v=a[g],d=u(v);for(const S of d)c[g]=S,h(g+1,c)};return h(0,new Array(a.length)),{bestParams:l,history:o,minError:r}}trainLegacy(t,n,i){const a=[];let o=n.min,r=i.min,l=1/0;for(let u=n.min;u<=n.max;u+=n.step)for(let h=i.min;h<=i.max;h+=i.step){const g=parseFloat(u.toFixed(2)),c=parseFloat(h.toFixed(2));this.model.setWeight(g),this.model.setBias(c);let v=0,d=0;for(const b of t){const p=this.model.predict(b.input),x=b.target-p;v+=x*x,d+=Math.abs(x)}const S=v/t.length,T=d/t.length;S<l&&(l=S,o=g,r=c),a.push({weight:g,bias:c,error:S,mae:T})}return{bestWeight:o,bestBias:r,history:a}}async trainAsync(t,n,i){if(!Array.isArray(n)){const d=arguments[1],S=arguments[2],T=arguments[3];let b=d.min,p=S.min,x=1/0,P=[];const C=20;let m=0;for(let M=d.min;M<=d.max;M+=d.step)for(let _=S.min;_<=S.max;_+=S.step){const s=parseFloat(M.toFixed(2)),A=parseFloat(_.toFixed(2));this.model.setWeight(s),this.model.setBias(A);let W=0,L=0;for(const z of t){const w=this.model.predict(z.input),N=z.target-w;W+=N*N,L+=Math.abs(N)}const k=W/t.length,E=L/t.length;k<x&&(x=k,b=s,p=A);const y={weight:s,bias:A,error:k,mae:E};P.push(y),m++,m%C===0&&(T&&T(P,{bestWeight:b,bestBias:p,minError:x}),P=[],await new Promise(z=>setTimeout(z,0)))}return P.length>0&&T&&T(P,{bestWeight:b,bestBias:p,minError:x}),{bestWeight:b,bestBias:p,minError:x}}let o=1/0,r={},l=0;const u=50;let h=[];const g=d=>{const S=[];if(d.step<=0)return[d.min];for(let T=d.min;T<=d.max+1e-4;T+=d.step)S.push(parseFloat(T.toFixed(2)));return S},c=n.map(g),v=async(d,S)=>{if(d===n.length){const b=[];let p=0;S.forEach((_,s)=>{n[s].name.toLowerCase().includes("bias")?p=_:b.push(_)}),this.model.setWeights?this.model.setWeights(b):this.model.setWeight&&this.model.setWeight(b[0]),this.model.setBias(p);let x=0,P=0;for(const _ of t){const s=this.model.predict(_.input),A=_.target-s;x+=A*A,P+=Math.abs(A)}const C=x/t.length,m=P/t.length;C<o&&(o=C,r={weights:[...b],bias:p});const M={params:[...S],error:C,mae:m};h.push(M),l++,l%u===0&&(i&&i(h,{bestParams:r,minError:o}),h=[],await new Promise(_=>setTimeout(_,0)));return}const T=c[d];for(const b of T)S[d]=b,await v(d+1,S)};return await v(0,new Array(n.length)),h.length>0&&i&&i(h,{bestParams:r,minError:o}),{bestParams:r,minError:o}}async trainRandomAsync(t,n,i){let l=1/0,u={},h=n.map(p=>({min:p.min,max:p.max,span:p.max-p.min})),g=h.map(p=>p.min+Math.random()*p.span);const c=p=>{const x=[];let P=0;p.forEach((M,_)=>{n[_].name.toLowerCase().includes("bias")?P=M:x.push(M)}),this.model.setWeights?this.model.setWeights(x):this.model.setWeight&&this.model.setWeight(x[0]),this.model.setBias(P);let C=0,m=0;for(const M of t){const _=this.model.predict(M.input),s=M.target-_;C+=s*s,m+=Math.abs(s)}return{mse:C/t.length,mae:m/t.length,weights:x,bias:P}};let v=c(g);l=v.mse,u={weights:v.weights,bias:v.bias,_array:[...g]},i&&i([{params:[...g],error:l,mae:v.mae}],{bestParams:u,minError:l}),await new Promise(p=>setTimeout(p,0));let d=[];const S=10;let T=l,b=[...g];for(let p=0;p<1e4;p++){const P=p<9e3;let C,m;if(P){const k=p/9e3;C=.2*(1-k*.5),m=.5*(1-k*.5)}else C=.1*(1-(p-9e3)/999.9999999999998),m=.5*.5*Math.pow(.992,p-1e4*.9);let M=!1;const _=[...b];let s=!1;for(;!s;)_.forEach((k,E)=>{if(Math.random()<.4)return;s=!0;const y=h[E];let z=!1;if(P){const H=y.span*.15;k<y.min+H&&(y.min-=y.span*.8,y.span=y.max-y.min,z=!0),k>y.max-H&&(y.max+=y.span*.8,y.span=y.max-y.min,z=!0),z&&(M=!0)}let w=y.span*m;z&&(w=Math.max(w,y.span*.25));const N=w;let R=k+(Math.random()-.5)*2*N;R<y.min&&(R=y.min),R>y.max&&(R=y.max),_[E]=R});const A=c(_),W=A.mse-T;let L=!1;if(W<0)L=!0;else{const k=Math.exp(-W/(C+1e-9));Math.random()<k&&(L=!0)}if(L&&(b=_,T=A.mse),A.mse<l&&(l=A.mse,u={weights:A.weights,bias:A.bias,_array:[..._]}),d.push({params:[..._],error:A.mse,mae:A.mae}),d.length>=S){let k;M&&(k="Grenzen dynamisch erweitert..."),i&&i(d,{bestParams:u,minError:l,message:k}),d=[],await new Promise(E=>setTimeout(E,0))}}return d.length>0&&i&&i(d,{bestParams:u,minError:l}),{bestParams:u,minError:l}}}function Pe({history:e,currentStepIndex:t,isTraining:n,paramsConfig:i}){const a=st(null);return mt(()=>{const o=a.current;if(!o||!e||e.length===0)return;const r=o.getContext("2d"),l=o.width,u=o.height;r.clearRect(0,0,l,u),r.fillStyle="#fff",r.fillRect(0,0,l,u);const h=Math.max(...e.map(x=>x.error)),c=!n&&e.length>0?e.length-1:t!==null&&t>=0?Math.min(t,e.length-1):-1;let v=-1,d=1/0;for(let x=0;x<=c;x++)e[x].error<d&&(d=e[x].error,v=x);let S=[];if(i){const x=i.length,P=x>=4?3:x,C=Math.ceil(x/P),m=l/P,M=u/C;S=i.map((_,s)=>{const A=e.map(y=>y.params[s]),W=Math.min(...A),L=Math.max(...A),k=s%P,E=Math.floor(s/P);return{xLabel:_.name,xMin:W,xMax:L,getValue:(y,z)=>y.params[s],offsetX:k*m,offsetY:E*M,w:m,h:M}})}else{const x=l/2,P=e.map(m=>m.weight),C=e.map(m=>m.bias);S=[{xLabel:"Weight",xMin:Math.min(...P),xMax:Math.max(...P),getValue:m=>m.weight,offsetX:0,offsetY:0,w:x,h:u},{xLabel:"Bias",xMin:Math.min(...C),xMax:Math.max(...C),getValue:m=>m.bias,offsetX:x,offsetY:0,w:x,h:u}]}const T=35;S.forEach(x=>{const{xLabel:P,xMin:C,xMax:m,getValue:M,offsetX:_,offsetY:s,w:A,h:W}=x,L=E=>s+W-T-E/(h||1)*(W-2*T),k=E=>_+T+(E-C)/(m-C||1)*(A-2*T);r.strokeStyle="#eee",r.strokeRect(_,s,A,W),r.beginPath(),r.strokeStyle="#333",r.lineWidth=1,r.moveTo(_+T,s+T),r.lineTo(_+T,s+W-T),r.lineTo(_+A-T,s+W-T),r.stroke(),r.fillStyle="#333",r.font="11px sans-serif",r.textAlign="center",r.fillText(P,_+A/2,s+W-10),_===0&&(r.save(),r.translate(_+10,s+W/2),r.rotate(-Math.PI/2),r.fillText("Error",0,0),r.restore()),r.fillStyle="#666",r.font="9px sans-serif",r.fillText(C.toFixed(1),_+T,s+W-T+12),r.fillText(m.toFixed(1),_+A-T,s+W-T+12),r.fillStyle="rgba(52, 152, 219, 0.4)";for(let E=0;E<=c;E++){const y=M(e[E],E),z=k(y),w=L(e[E].error);r.fillRect(z,w,2,2)}if(v>=0){const E=M(e[v],v),y=k(E),z=L(e[v].error);r.beginPath(),r.fillStyle="#2ecc71",r.strokeStyle="#27ae60",r.arc(y,z,6,0,Math.PI*2),r.fill(),r.stroke()}if(n&&t!==null&&t>=0&&t<=c){const E=M(e[t],t),y=k(E),z=L(e[t].error);r.beginPath(),r.fillStyle="#e74c3c",r.strokeStyle="#c0392b",r.arc(y,z,5,0,Math.PI*2),r.fill(),r.stroke()}});const b=l-120,p=10;r.fillStyle="rgba(255,255,255,0.8)",r.fillRect(b,p,110,50),r.strokeStyle="#ccc",r.strokeRect(b,p,110,50),r.textAlign="left",r.font="10px sans-serif",r.beginPath(),r.fillStyle="#e74c3c",r.arc(b+10,p+15,4,0,Math.PI*2),r.fill(),r.fillStyle="#333",r.fillText("Current Scan",b+20,p+18),r.beginPath(),r.fillStyle="#2ecc71",r.arc(b+10,p+35,4,0,Math.PI*2),r.fill(),r.fillStyle="#333",r.fillText("Best So Far",b+20,p+38),!n&&v>=0&&(r.fillStyle="#333",r.font="bold 12px sans-serif",r.textAlign="right",r.fillText(`Min Error: ${d.toFixed(5)}`,l-10,u-10))},[e,t,n,i]),f("div",{style:{border:"1px solid #ccc",borderRadius:"8px",padding:"10px",background:"#fff"},children:f("canvas",{ref:a,width:800,height:400,style:{width:"100%",height:"auto"}})})}function We({input:e,weight:t,bias:n,output:i,formula:a="y = w * x + b",inputLabel:o="Input",outputLabel:r="Output",biasLabel:l="b"}){const g=Array.isArray(e)?e:[e],c=Array.isArray(t)?t:[t],v=Array.isArray(o)?o:[o],d=Number(n)||0,S=Number(i)||0,T=g.length,b=100,p=80,x=b-(T-1)*p/2,P=50,C=Math.max(200,T*80+50);return f("div",{style:{border:"1px solid #ccc",borderRadius:"8px",padding:"10px",background:"#fff",textAlign:"center"},children:[f("h3",{children:"Modell Architektur"}),f("svg",{width:"350",height:C,style:{overflow:"visible"},children:[f("title",{children:"Network Visualization"}),f("defs",{children:f("marker",{id:"arrowhead",markerWidth:"10",markerHeight:"7",refX:"28",refY:"3.5",orient:"auto",children:f("polygon",{points:"0 0, 10 3.5, 0 7",fill:"#333"})})}),g.map((m,M)=>{const _=x+M*p,s=Number(c[M])||0,A=v[M]||`x${M+1}`,W=Number(m)||0;return f("g",{children:[f("line",{x1:P,y1:_,x2:300,y2:b,stroke:"#333",strokeWidth:"2",markerEnd:"url(#arrowhead)"}),f("g",{transform:`translate(${(P+300)/2-15}, ${(_+b)/2-10})`,children:[f("rect",{x:"-15",y:"-10",width:"40",height:"20",fill:"#fff",rx:"4",stroke:"#ccc"}),f("text",{x:"5",y:"5",textAnchor:"middle",fill:"#e74c3c",fontSize:"11",fontWeight:"bold",children:s.toFixed(1)})]}),f("circle",{cx:P,cy:_,r:30,fill:"#fff",stroke:"#333",strokeWidth:"2"}),f("text",{x:P,y:_,textAnchor:"middle",dominantBaseline:"middle",fontWeight:"bold",fontSize:"12",children:["In ",M+1]}),f("text",{x:P,y:_+40,textAnchor:"middle",fontSize:"10",fill:"#555",children:A}),f("text",{x:P,y:_+52,textAnchor:"middle",fontSize:"12",fill:"#333",fontWeight:"bold",children:W.toFixed(0)})]},M)}),f("line",{x1:300,y1:b+60,x2:300,y2:b+30,stroke:"#333",strokeWidth:"2",markerEnd:"url(#arrowhead)"}),f("circle",{cx:300,cy:b+80,r:5,fill:"#2980b9"}),f("text",{x:315,y:b+80,textAnchor:"start",dominantBaseline:"middle",fill:"#2980b9",fontSize:"12",fontWeight:"bold",children:[l,": ",d.toFixed(2)]}),f("circle",{cx:300,cy:b,r:30,fill:"#fff",stroke:"#333",strokeWidth:"2","aria-label":"Output Node"}),f("text",{x:300,y:b,textAnchor:"middle",dominantBaseline:"middle",fontWeight:"bold",children:"Output"}),f("text",{x:300,y:b-45,textAnchor:"middle",fontSize:"12",fill:"#555",children:r}),f("text",{x:300,y:b-60,textAnchor:"middle",fontSize:"14",fill:"#333",fontWeight:"bold",children:S.toFixed(2)}),f("text",{x:175,y:C-10,textAnchor:"middle",fontSize:"12",fontStyle:"italic",fill:"#777",children:a})]})]})}function Ce({onGenerateData:e,onTrain:t,onRun:n,onReset:i,isTraining:a,trainingStep:o,dataCount:r,trainerType:l,onTrainerTypeChange:u}){return f("div",{role:"region","aria-label":"Steuerung",style:{padding:"20px",background:"#eee",borderRadius:"8px",display:"flex",gap:"10px",flexWrap:"wrap",alignItems:"center"},children:[f("button",{onClick:e,disabled:a,children:"1. Trainingsdaten Generieren"}),f("span",{"aria-live":"polite",children:["Datenpunkte: ",r]}),f("div",{style:{borderLeft:"1px solid #ccc",paddingLeft:"10px",marginLeft:"10px",display:"flex",gap:"5px",alignItems:"center"},children:[f("select",{"aria-label":"Trainingsmethode",value:l,onChange:h=>u(h.target.value),disabled:a,style:{padding:"8px",borderRadius:"4px",border:"1px solid #ccc"},children:[f("option",{value:"exhaustive",children:"Grid Search (Genau)"}),f("option",{value:"random",children:"Adaptive Random (Schnell)"})]}),f("button",{onClick:t,disabled:a||r===0,"aria-busy":a,children:a?"Suche läuft...":"2. Trainieren"})]}),f("button",{onClick:n,disabled:a,children:"3. Simulation Starten"}),f("button",{onClick:i,style:{marginLeft:"auto",background:"#e74c3c",color:"white"},"aria-label":"Simulation zurücksetzen",children:"Reset"})]})}class Re{constructor(t=30,n=50){this.velocity=t,this.initialPosition=n}getPosition(t){return this.velocity*t+this.initialPosition}}class Ee{constructor(){this.weight=0,this.bias=0}predict(t){return this.weight*t+this.bias}setWeight(t){this.weight=t}setBias(t){this.bias=t}}function Le({time:e,groundTruth:t,neuralNet:n,maxDistance:i=300}){const a=st(null);mt(()=>{const r=a.current;if(!r)return;const l=r.getContext("2d"),u=r.width,h=r.height,g=50,c=u-2*g;l.clearRect(0,0,u,h);const v=t.getPosition(e),d=n.predict(e),S=g+v%i/i*c,T=g+d%i/i*c;l.fillStyle="#f0f0f0",l.fillRect(0,0,u,h/2),l.fillStyle="#e0e0e0",l.fillRect(0,h/2,u,h/2),l.beginPath(),l.strokeStyle="#fff",l.setLineDash([20,20]),l.moveTo(0,h/4),l.lineTo(u,h/4),l.moveTo(0,h*3/4),l.lineTo(u,h*3/4),l.stroke(),l.beginPath(),l.strokeStyle="#ccc",l.setLineDash([]),l.moveTo(g,0),l.lineTo(g,h),l.moveTo(u-g,0),l.lineTo(u-g,h),l.stroke(),o(l,S,h/4,"#2ecc71","Ground Truth"),o(l,T,h*3/4,"#e74c3c","Neural Net"),l.fillStyle="#333",l.font="14px monospace",l.fillText(`Zeit: ${e.toFixed(1)}s`,10,20),l.fillText(`Pos GT: ${v.toFixed(1)}m`,10,40),l.fillText(`Pos NN: ${d.toFixed(1)}m`,10,h/2+40)},[e,t,n,i]);function o(r,l,u,h,g){r.save(),r.translate(l,u),r.fillStyle=h,r.fillRect(-20,-10,40,20),r.fillStyle="#000",r.fillRect(-15,-15,10,5),r.fillRect(5,-15,10,5),r.fillRect(-15,10,10,5),r.fillRect(5,10,10,5),r.fillStyle="#000",r.font="10px sans-serif",r.textAlign="center",r.fillText(g,0,-20),r.restore()}return f("div",{style:{border:"2px solid #333",borderRadius:"8px",overflow:"hidden"},children:f("canvas",{ref:a,width:800,height:300,style:{width:"100%",display:"block"}})})}const qt={id:"physics",title:"Phase 1: Lineare Regression (Exhaustive Search 2D)",description:"Physiksimulation: Weg-Zeit-Gesetz (s = v*t + s0)",Model:Ee,GroundTruth:Re,CanvasComponent:Le,defaultParams:{weight:0,bias:0},groundTruthDefaults:[30,50],getInput:e=>e,generateData:e=>Array.from({length:20},(n,i)=>i*.5).map(n=>({input:n,target:e.getPosition(n)})),trainingConfig:{weightRange:{min:0,max:60,step:1},biasRange:{min:0,max:100,step:2}},networkViz:{formula:"pos = w * t + b",inputLabel:"Zeit (t)",outputLabel:"Pos (m)",biasLabel:"b"}};class $e{constructor(t=.5,n=-5){this.weight=t,this.bias=n}sigmoid(t){return 1/(1+Math.exp(-t))}classify(t){const n=this.sigmoid(this.weight*t+this.bias);return Math.random()<n?1:0}getProbability(t){return this.sigmoid(this.weight*t+this.bias)}}class ze{constructor(){this.weight=0,this.bias=0}sigmoid(t){return 1/(1+Math.exp(-t))}predict(t){const n=this.weight*t+this.bias;return this.sigmoid(n)}setWeight(t){this.weight=t}setBias(t){this.bias=t}}function Ne({time:e,groundTruth:t,neuralNet:n}){const i=st(null);return mt(()=>{const a=i.current;if(!a)return;const o=a.getContext("2d"),r=a.width,l=a.height;o.clearRect(0,0,r,l);const u=40,h=r-2*u,g=l-2*u,c=0,v=20,d=m=>u+m/v*h,S=m=>l-u-m*g;o.beginPath(),o.strokeStyle="#eee";for(let m=0;m<=4;m++){const M=S(m*.25);o.moveTo(u,M),o.lineTo(r-u,M)}for(let m=0;m<=10;m++){const M=d(m*2);o.moveTo(M,u),o.lineTo(M,l-u)}o.stroke(),o.beginPath(),o.strokeStyle="#333",o.moveTo(u,u),o.lineTo(u,l-u),o.lineTo(r-u,l-u),o.stroke(),o.fillStyle="#333",o.textAlign="center",o.fillText("Anzahl 'Spam' Wörter",r/2,l-10),o.save(),o.translate(15,l/2),o.rotate(-Math.PI/2),o.fillText("Spam Wahrscheinlichkeit",0,0),o.restore();const T=(m,M,_=[])=>{o.beginPath(),o.strokeStyle=M,o.setLineDash(_),o.lineWidth=2;for(let s=c;s<=v;s+=.5){let A=0;typeof m.getProbability=="function"?A=m.getProbability(s):typeof m.predict=="function"&&(A=m.predict(s));const W=d(s),L=S(A);s===c?o.moveTo(W,L):o.lineTo(W,L)}o.stroke(),o.setLineDash([])};T(t,"#ccc",[5,5]),T(n,"#e74c3c");const p=Math.floor(e*2),x=50,P=m=>{const M=Math.sin(m*123.456)*1e4;return M-Math.floor(M)},C=Math.min(p,x);for(let m=0;m<C;m++){const M=P(m+1),_=Math.floor(M*21),s=t.getProbability(_),W=P(m+999)<s?1:0,L=d(_),k=S(W);o.beginPath();const E=(P(m+333)-.5)*10,y=(P(m+444)-.5)*10;o.arc(L+E,k+y,5,0,Math.PI*2),o.fillStyle=W?"#e74c3c":"#2ecc71",o.fill(),o.strokeStyle="#fff",o.stroke()}if(C>0&&C<=x){const m=C-1,M=P(m+1),_=Math.floor(M*21),s=t.getProbability(_),W=P(m+999)<s?1:0,L=(P(m+333)-.5)*10,k=(P(m+444)-.5)*10,E=d(_)+L,y=S(W)+k;o.beginPath(),o.arc(E,y,8,0,Math.PI*2),o.strokeStyle="#333",o.stroke(),o.fillStyle="#333",o.font="10px sans-serif",o.fillText(`${_}`,E,y-12)}},[e,t,n]),f("div",{className:"canvas-container",children:f("canvas",{ref:i,width:600,height:300,style:{width:"100%",border:"1px solid #ccc",background:"#fff"}})})}const Fe=e=>{const t=Math.sin(e)*1e4;return t-Math.floor(t)},Kt={id:"spam",title:"Phase 2: Logistische Regression (Spam Filter)",description:"Spam-Erkennung: Wahrscheinlichkeit p = σ(w*x + b)",Model:ze,GroundTruth:$e,CanvasComponent:Ne,defaultParams:{weight:0,bias:0},groundTruthDefaults:[.5,-5],getInput:e=>{const t=Math.floor(e);return Math.floor(Fe(t)*20)},generateData:e=>{const t=[];for(let n=0;n<50;n++){const i=Math.floor(Math.random()*21),a=e.classify(i);t.push({input:i,target:a})}return t.sort((n,i)=>n.input-i.input)},trainingConfig:{weightRange:{min:0,max:2,step:.1},biasRange:{min:-10,max:5,step:.5}},networkViz:{formula:"p = σ(w * x + b)",inputLabel:"Wörter (x)",outputLabel:"Spam? (p)",biasLabel:"b"},isFinished:e=>e>=25};class Ie{constructor(t=[.5,.2,.8,-.1],n=-3){this.weights=t,this.bias=n}sigmoid(t){return 1/(1+Math.exp(-t))}classify(t){let n=this.bias;for(let a=0;a<this.weights.length;a++)n+=this.weights[a]*t[a];const i=this.sigmoid(n);return Math.random()<i?1:0}getProbability(t){let n=this.bias;for(let i=0;i<this.weights.length;i++)n+=this.weights[i]*t[i];return this.sigmoid(n)}}class He{constructor(t=4){this.weights=new Array(t).fill(0),this.bias=0}sigmoid(t){return 1/(1+Math.exp(-t))}predict(t){let n=this.bias;for(let i=0;i<this.weights.length;i++)n+=this.weights[i]*t[i];return this.sigmoid(n)}setWeights(t){this.weights=[...t]}setBias(t){this.bias=t}setWeightAt(t,n){t>=0&&t<this.weights.length&&(this.weights[t]=n)}}const J=[{label:"Spam Words",idx:0,max:15},{label:"Großbuchstaben",idx:1,max:25},{label:"Links",idx:2,max:8},{label:"Gesamtworte",idx:3,max:100}];function De({data:e,currentInput:t,currentPrediction:n,neuralNet:i}){const a=st(null),[o,r]=Q("scatter"),[l,u]=Q(0),[h,g]=Q(3),[c,v]=Q(2),[d,S]=Q({x:-.5,y:.5}),T=st(!1),b=st({x:0,y:0}),[p,x]=Q(null),P=_=>{o==="3d"&&(T.current=!0,b.current={x:_.clientX,y:_.clientY})},C=_=>{if(T.current&&o==="3d"){const s=_.clientX-b.current.x,A=_.clientY-b.current.y;S(W=>({x:W.x+A*.01,y:W.y+s*.01})),b.current={x:_.clientX,y:_.clientY};return}if(o==="scatter"){const s=a.current;if(!s)return;const A=s.getBoundingClientRect(),W=_.clientX-A.left,L=_.clientY-A.top;let k=null;const E=10,y=50,z=s.width-2*y,w=s.height-2*y,N=y,R=s.height-y,H=J[l].max,X=J[h].max;if(e)for(const F of e){const B=N+F.input[l]/H*z,it=R-F.input[h]/X*w;if(Math.sqrt((B-W)**2+(it-L)**2)<E){k={x:B,y:it,text:F.text,isSpam:F.target===1};break}}x(k)}else x(null)},m=()=>{T.current=!1},M=()=>{x(null)};return mt(()=>{const _=a.current;if(!_)return;const s=_.getContext("2d"),A=_.width,W=_.height;s.clearRect(0,0,A,W),s.fillStyle="#fff",s.fillRect(0,0,A,W);const L=w=>{if(!e||e.length===0)return J[w].max;const N=Math.max(...e.map(R=>R.input[w]));return N>0?N:J[w].max};if(o==="3d"){const w=L(l),N=L(h),R=L(c),H=A/2,X=W/2,F=150,B=($,D,Y)=>{let q=$*Math.cos(d.y)-Y*Math.sin(d.y),O=$*Math.sin(d.y)+Y*Math.cos(d.y),at=D*Math.cos(d.x)-O*Math.sin(d.x),ft=D*Math.sin(d.x)+O*Math.cos(d.x);const j=400/(400-ft);return{x:H+q*j,y:X+at*j,z:ft}},Z=[[-1,-1,-1],[1,-1,-1],[1,1,-1],[-1,1,-1],[-1,-1,1],[1,-1,1],[1,1,1],[-1,1,1]].map($=>B($[0]*F,$[1]*F,$[2]*F)),ht="#e29301ff",U="#2980b9",ot="#c00798ff",tt=($,D)=>{s.beginPath(),s.strokeStyle=D,s.lineWidth=1,$.forEach(([Y,q])=>{s.moveTo(Z[Y].x,Z[Y].y),s.lineTo(Z[q].x,Z[q].y)}),s.stroke()};tt([[0,1],[3,2],[4,5],[7,6]],ht),tt([[0,3],[1,2],[4,7],[5,6]],U),tt([[0,4],[1,5],[2,6],[3,7]],ot),s.font="bold 11px sans-serif",s.fillStyle=ht,s.fillText("X: "+J[l].label,Z[1].x,Z[1].y),s.fillStyle=U,s.fillText("Y: "+J[h].label,Z[3].x,Z[3].y),s.fillStyle=ot,s.fillText("Z: "+J[c].label,Z[4].x,Z[4].y);const et=[],nt=($,D)=>$/D*2-1;if(i&&i.weights){const $=i.weights[l]||0,D=i.weights[h]||0,Y=i.weights[c]||0,q=i.bias||0;if(Math.abs(Y)>.001){s.strokeStyle="rgba(142, 68, 173, 0.3)",s.lineWidth=1;const O=(j,K)=>{const lt=(j+1)/2*w,ct=(K+1)/2*N,_e=(-$*lt-D*ct-q)/Y;return nt(_e,R)},at=(j,K)=>{if(Math.abs(j.z)<=3&&Math.abs(K.z)<=3){const lt=B(j.x*F,-j.y*F,j.z*F),ct=B(K.x*F,-K.y*F,K.z*F);s.beginPath(),s.moveTo(lt.x,lt.y),s.lineTo(ct.x,ct.y),s.stroke()}},ft=6;for(let j=0;j<=ft;j++){const K=-1+j/ft*2,lt=O(-1,K),ct=O(1,K);at({x:-1,y:K,z:lt},{x:1,y:K,z:ct})}for(let j=0;j<=ft;j++){const K=-1+j/ft*2,lt=O(K,-1),ct=O(K,1);at({x:K,y:-1,z:lt},{x:K,y:1,z:ct})}}}e&&e.forEach($=>{const D=nt($.input[l],w),Y=-nt($.input[h],N),q=nt($.input[c],R),O=B(D*F,Y*F,q*F);et.push({...O,color:$.target===1?"#e74c3c":"#2ecc71",radius:3})}),et.sort(($,D)=>$.z-D.z),et.forEach($=>{s.beginPath(),s.arc($.x,$.y,$.radius,0,Math.PI*2),s.fillStyle=$.color,s.fill(),$.border&&(s.strokeStyle="#fff",s.lineWidth=2,s.stroke())});return}if(o==="scatter"){const w=L(l),N=L(h),R=50,H=A-2*R,X=W-2*R,F=R,B=W-R,it="#c0392b",Z="#2980b9";s.lineWidth=2,s.beginPath(),s.strokeStyle=it,s.moveTo(F,B),s.lineTo(F+H,B),s.stroke(),s.beginPath(),s.strokeStyle=Z,s.moveTo(F,B),s.lineTo(F,B-X),s.stroke(),s.textAlign="center",s.font="bold 14px sans-serif",s.fillStyle=it,s.fillText(`${J[l].label} (max: ${w})`,F+H/2,B+35),s.save(),s.translate(15,B-X/2),s.rotate(-Math.PI/2),s.fillStyle=Z,s.fillText(`${J[h].label} (max: ${N})`,0,0),s.restore();const ht=(U,ot,tt,et)=>{const nt=U[l],$=U[h],D=F+nt/w*H,Y=B-$/N*X;s.beginPath(),s.arc(D,Y,tt,0,2*Math.PI),s.fillStyle=ot,s.fill(),et&&(s.strokeStyle=et,s.lineWidth=2,s.stroke())};if(e&&e.forEach(U=>{ht(U.input,U.target===1?"#e74c3c":"#2ecc71",5,"#fff")}),i){let U=i.weights;const ot=i.bias||0;if(U){const tt=U[l]||0,et=U[h]||0,nt=ot,$=(Y,q)=>{const O=F+Y/w*H,at=B-q/N*X;return{x:O,y:at}};if(s.beginPath(),s.strokeStyle="#c0392b",s.strokeStyle="rgba(142, 68, 173, 0.8)",s.lineWidth=2,s.setLineDash([10,5]),Math.abs(et)>.001){const Y=at=>(-tt*at-nt)/et,q=$(0,Y(0)),O=$(w,Y(w));s.moveTo(q.x,q.y),s.lineTo(O.x,O.y)}else if(Math.abs(tt)>.001){const Y=-nt/tt,q=$(Y,0),O=$(Y,N);s.moveTo(q.x,q.y),s.lineTo(O.x,O.y)}s.stroke(),s.setLineDash([]),s.fillStyle="rgba(142, 68, 173, 1)",s.font="bold 12px monospace",s.textAlign="left";const D=`${tt.toFixed(2)}x + ${et.toFixed(2)}y + ${nt.toFixed(2)} = 0`;s.fillText(D,F+10,B-X-5)}}if(t&&ht(t,"#3498db",8,"#2980b9"),s.fillStyle="#666",s.textAlign="right",s.font="11px sans-serif",s.fillText("Rot=Spam, Grün=OK",A-10,20),p){s.save(),s.fillStyle="rgba(0,0,0,0.85)",s.strokeStyle="#fff";const U=p.text||"No Text",ot=p.isSpam?"SPAM":"HAM",tt=s.measureText(U),et=Math.max(tt.width,100)+20,nt=50;let $=p.x+15,D=p.y-15;$+et>A&&($=p.x-et-10),D+nt>W&&(D=p.y-nt-10),D<0&&(D=p.y+20),s.beginPath(),s.roundRect($,D,et,nt,5),s.fill(),s.lineWidth=1,s.stroke(),s.textBaseline="top",s.textAlign="left",s.font="bold 12px sans-serif",s.fillStyle=p.isSpam?"#e74c3c":"#2ecc71",s.fillText(ot,$+10,D+10),s.font="italic 11px sans-serif",s.fillStyle="#ddd",s.fillText(U,$+10,D+28),s.restore()}return}if(o==="text"){if(s.textAlign="center",s.textBaseline="middle",!t||!t.text){s.fillStyle="#999",s.font="20px sans-serif",s.fillText("Kein Text verfügbar",A/2,W/2);return}const w=n>.5,N=w?"#feeff0":"#effaf0";s.fillStyle=N,s.fillRect(0,0,A,W);const R=t.text;s.fillStyle="#333",s.font="24px serif";const H=R.split(" ");let X="";const F=35,B=A/2;let it=W/3;const Z=A-100;for(let ot=0;ot<H.length;ot++){const tt=X+H[ot]+" ";s.measureText(tt).width>Z&&ot>0?(s.fillText(X,B,it),X=H[ot]+" ",it+=F):X=tt}s.fillText(X,B,it),it+=60;const ht=t.groundTruth===1;s.font="bold 16px sans-serif",s.fillStyle="#555",s.fillText(`Wahrheit: ${ht?"SPAM":"HAM"}`,B,it),it+=30;const U=(n*100).toFixed(1);s.font="bold 20px sans-serif",s.fillStyle=w?"#c0392b":"#27ae60",s.fillText(`Vorhersage: ${w?"SPAM":"HAM"} (${U}%)`,B,it);return}const k=30,E=(A-3*k)/2,y=(W-3*k)/2;[{x:k,y:k,...J[0]},{x:k+E+k,y:k,...J[1]},{x:k,y:k+y+k,...J[2]},{x:k+E+k,y:k+y+k,...J[3]}].forEach(w=>{if(s.strokeStyle="#ccc",s.strokeRect(w.x,w.y,E,y),s.fillStyle="#333",s.font="12px Arial",s.textAlign="center",s.fillText(w.label,w.x+E/2,w.y-5),e&&e.forEach(N=>{const R=N.input[w.idx],H=w.x+R/w.max*E,X=w.y+y-N.target*(y-20)-10;s.beginPath(),s.arc(H,X,3,0,2*Math.PI),s.fillStyle=N.target?"rgba(231, 76, 60, 0.6)":"rgba(46, 204, 113, 0.6)",s.fill()}),t){const N=t[w.idx],R=w.x+N/w.max*E;s.beginPath(),s.moveTo(R,w.y),s.lineTo(R,w.y+y),s.strokeStyle="#3498db",s.setLineDash([5,5]),s.stroke(),s.setLineDash([])}})},[e,t,n,o,l,h,c,d]),f("div",{style:{textAlign:"center"},children:[f("div",{style:{marginBottom:"10px",display:"flex",gap:"5px",justifyContent:"center",flexWrap:"wrap",fontSize:"0.9rem"},children:[f("select",{value:o,onChange:_=>r(_.target.value),style:{padding:"4px"},children:[f("option",{value:"features",children:"Alle Features"}),f("option",{value:"scatter",children:"2D Plot"}),f("option",{value:"3d",children:"3D Plot"}),f("option",{value:"text",children:"Text Mode"})]}),(o==="scatter"||o==="3d")&&f(_t,{children:[f("span",{children:"X:"}),f("select",{value:l,onChange:_=>u(parseInt(_.target.value)),style:{padding:"4px"},children:J.map(_=>f("option",{value:_.idx,children:_.label},_.idx))}),f("span",{children:"Y:"}),f("select",{value:h,onChange:_=>g(parseInt(_.target.value)),style:{padding:"4px"},children:J.map(_=>f("option",{value:_.idx,children:_.label},_.idx))})]}),o==="3d"&&f(_t,{children:[f("span",{children:"Z:"}),f("select",{value:c,onChange:_=>v(parseInt(_.target.value)),style:{padding:"4px"},children:J.map(_=>f("option",{value:_.idx,children:_.label},_.idx))})]})]}),f("canvas",{ref:a,width:600,height:400,style:{border:"1px solid #eee",maxWidth:"100%",borderRadius:"4px",cursor:o==="3d"?"grab":"default"},onMouseDown:P,onMouseMove:C,onMouseUp:m,onMouseLeave:m,onMouseOut:M}),f("div",{style:{fontSize:"0.8rem",color:"#666",marginTop:"5px"},children:o==="3d"?"Drag to rotate 3D view":"Wähle Achsen für die Visualisierung"})]})}const Jt=e=>{const t=Math.sin(e)*1e4;return t-Math.floor(t)},Pt=e=>{const t=["winner","won","gift card","urgent","rolex","viagra","cash","prize","singles","marketing","buy","free","money","security alert","click","claim","fake","verification"],n=e.toLowerCase();let i=0;t.forEach(l=>{n.includes(l)&&(i+=1)}),i>10&&(i=10);const a=(e.match(/[A-Z]/g)||[]).length,o=(e.match(/http/g)||[]).length,r=e.split(/\s+/).length;return[i,a,o,r]},dt={id:"spam_advanced",title:"Phase 3: Erweiterter Spam-Filter (4 Eingaben)",description:"Spam-Erkennung mit 4 Merkmalen: Spam-Worte, Großbuchstaben, Links, Gesamtworte.",Model:He,GroundTruth:Ie,CanvasComponent:De,defaultParams:{weights:[0,0,0,0],bias:0},groundTruthDefaults:[[1.5,.5,2,-.5],-5],getInput:e=>{const t=Math.floor(e*.3),n=Jt(t)>.5,i=n?dt.examples.spam:dt.examples.ham,a=Math.floor(Jt(t+99)*i.length),o=i[a],r=Pt(o);return r.text=o,r.groundTruth=n?1:0,r},examples:{spam:["WINNER! Won $1000 Gift Card! Claim at http://prize-giveaway.net","URGENT: Verify account at http://secure-bank-login.com/fraud","Cheap Rolex watches! 50% OFF at www.fake-watches.cn","Lose weight fast! Buy pills: http://diet-miracle.com","CONGRATS! Cash prize waiting: http://claim-money.org","HOT singles waiting! Chat now: http://local-dating.xyz","Refinance 1% APR. Apply: http://easy-loans.biz","Buy 1 get 1 FREE Viagra. http://meds-direct.com","Meet rich men. Signup: http://millionaire-match.com","SECURITY ALERT: Suspicious activity. Check http://account-security-check.com"],ham:["Meeting agenda for tomorrow's team sync","Hey, are we still on for lunch?","Invoice #12345 from AWS Services","Project deadline extended to Friday","Happy Birthday! Hope you have a great day.","Can you review this pull request?","Your Amazon order has shipped.","Fwd: Tickets for the concert","Question about the quarterly report","Let's catch up sometime next week."]},generateData:e=>{const t=[];dt.examples.spam.forEach(n=>{const i=Pt(n),a=()=>(Math.random()-.5)*.1,o=i.map(r=>Math.max(0,r+a()));t.push({input:o,target:1,text:n})}),dt.examples.ham.forEach(n=>{const a=Pt(n).map(o=>Math.max(0,o+(Math.random()-.5)*.1));t.push({input:a,target:0,text:n})});for(let n=t.length-1;n>0;n--){const i=Math.floor(Math.random()*(n+1));[t[n],t[i]]=[t[i],t[n]]}return t},trainingConfig:{params:[{name:"w1 (Spam-Worte)",min:1,max:4,step:.5},{name:"w2 (Großbuchst.)",min:0,max:2,step:.5},{name:"w3 (Links)",min:0,max:3,step:.5},{name:"w4 (Gesamtworte)",min:-2,max:2,step:.5},{name:"bias",min:-8,max:8,step:2}]},networkViz:{formula:"p = σ(w₁x₁ + w₂x₂ + w₃x₃ + w₄x₄ + b)",inputLabels:["Spam-Worte","Großbuchst.","Links","Gesamtworte"],outputLabel:"Spam? (p)",biasLabel:"b"},isFinished:e=>e>=50},Qt={[qt.id]:qt,[Kt.id]:Kt,[dt.id]:dt};function Xe(e){return Qt[e]||Qt.physics}function Be(){const[e,t]=Q(null),n=st(null),i=st(null),[a,o]=Q(0),[r,l]=Q(!1),[u,h]=Q([]),[g,c]=Q([]),[v,d]=Q(-1),[S,T]=Q(!1),[b,p]=Q("simulation"),[x,P]=Q("exhaustive"),[C,m]=Q("Bereit."),M=st(0);mt(()=>{const z=new URLSearchParams(window.location.search).get("sim")||"physics",w=Xe(z);if(!w){m("Fehler: Simulation nicht gefunden.");return}try{n.current=new w.GroundTruth(...w.groundTruthDefaults||[]),i.current=new w.Model,w.defaultParams&&(w.defaultParams.weight!==void 0&&i.current.setWeight(w.defaultParams.weight),w.defaultParams.weights!==void 0&&i.current.setWeights&&i.current.setWeights(w.defaultParams.weights),w.defaultParams.bias!==void 0&&i.current.setBias(w.defaultParams.bias)),t(w)}catch(N){console.error("Initialization Error:",N),m(`Init Fehler: ${N.message}`)}},[]),mt(()=>{let y;const z=w=>{if(!r)return;M.current===0&&(M.current=w);const N=(w-M.current)/1e3;M.current=w;const R=Math.min(N,.1);o(H=>{const F=H+R*3;return e&&e.isFinished&&e.isFinished(F)&&(l(!1),m("Simulation beendet.")),F}),y=requestAnimationFrame(z)};return r&&(M.current=0,y=requestAnimationFrame(z)),()=>cancelAnimationFrame(y)},[r,e]);const _=()=>{try{if(!e)return;if(!n.current)throw new Error("Ground Truth not initialized");const y=e.generateData(n.current);h(y),m(`${y.length} Trainingsdaten generiert.`),p("data")}catch(y){console.error("Generate Data Error:",y),m(`Fehler beim Generieren: ${y.message}`)}},s=async()=>{try{if(u.length===0||!e)return;T(!0),d(0),c([]),m("Suche optimales Gewicht und Bias (Live Visualisierung)..."),p("training");const y=new Ae(i.current),z=(N,R)=>{if(c(H=>{const X=[...H,...N];return d(X.length-1),X}),(R&&R.message||R&&R.message)&&m(R.message),R&&R.bestParams){if(i.current.setWeights){const{weights:H,bias:X}=R.bestParams;i.current.setWeights(H),i.current.setBias(X)}}else R&&R.bestWeight!==void 0&&(i.current.setWeight(R.bestWeight),i.current.setBias(R.bestBias))};let w;x==="random"?(m("Suche optimales Gewicht und Bias (Random Search)..."),w=await y.trainRandomAsync(u,e.trainingConfig.params,z)):e.trainingConfig.params?w=await y.trainAsync(u,e.trainingConfig.params,z):w=await y.trainAsync(u,e.trainingConfig.weightRange,e.trainingConfig.biasRange,z),m(`Training fertig! Min Error: ${w.minError.toFixed(5)}`),T(!1)}catch(y){console.error("Training Error:",y),T(!1),m(`Fehler beim Training: ${y.message}`)}},A=()=>{o(0),l(!0),m("Simulation läuft..."),p("simulation")},W=()=>{l(!1),o(0),h([]),c([]),d(-1);try{i.current&&e?.defaultParams&&(e.defaultParams.weight!==void 0&&i.current.setWeight(e.defaultParams.weight),e.defaultParams.weights!==void 0&&i.current.setWeights&&i.current.setWeights(e.defaultParams.weights),e.defaultParams.bias!==void 0&&i.current.setBias(e.defaultParams.bias))}catch(y){console.error("Reset Error:",y)}m("Reset durchgeführt.")};if(!e)return f("div",{children:"Lade Simulation..."});const L=e.CanvasComponent,k=e.networkViz||{},E=e.getInput?e.getInput(a):a;return f("div",{className:"container",children:[f("header",{children:[f("h1",{children:"Neural Network Demonstrator"}),f("p",{children:e.title}),f("div",{className:"sim-selector",style:{fontSize:"0.8rem",marginTop:"5px"},children:[f("a",{href:"?sim=physics",style:{marginRight:"10px",fontWeight:e.id==="physics"?"bold":"normal"},children:"Phase 1 (Physik)"}),f("a",{href:"?sim=spam",style:{marginRight:"10px",fontWeight:e.id==="spam"?"bold":"normal"},children:"Phase 2 (Spam)"}),f("a",{href:"?sim=spam_advanced",style:{fontWeight:e.id==="spam_advanced"?"bold":"normal"},children:"Phase 3 (Spam Extended)"})]})]}),f("main",{children:[f("div",{className:"top-section",style:{display:"flex",gap:"20px",flexWrap:"wrap",alignItems:"start"},children:[f("div",{className:"simulation-wrapper",style:{flex:"1 1 500px"},children:f("div",{className:"simulation-section",children:[f("div",{className:"tabs",role:"tablist",children:[f("button",{id:"tab-simulation",role:"tab","aria-selected":b==="simulation","aria-controls":"panel-simulation",className:`tab-button ${b==="simulation"?"active":""}`,onClick:()=>p("simulation"),children:"Simulation"}),f("button",{id:"tab-data",role:"tab","aria-selected":b==="data","aria-controls":"panel-data",className:`tab-button ${b==="data"?"active":""}`,onClick:()=>p("data"),children:"Trainingsdaten"}),f("button",{id:"tab-training",role:"tab","aria-selected":b==="training","aria-controls":"panel-training",className:`tab-button ${b==="training"?"active":""}`,onClick:()=>p("training"),children:"Training"})]}),b==="simulation"&&f("div",{role:"tabpanel",id:"panel-simulation","aria-labelledby":"tab-simulation",children:[(()=>{let y=0;try{i.current&&(y=i.current.predict(E))}catch(z){console.error("Predict Error",z)}return f(L,{time:a,data:u,currentInput:E,currentPrediction:y,groundTruth:n.current,neuralNet:i.current})})(),f("div",{className:"stats",style:{marginTop:"10px"},children:[f("p",{children:e.description}),f("p",{style:{color:"#646cff",fontWeight:"bold"},children:["Status: ",C]})]})]}),b==="data"&&f("div",{className:"data-content",role:"tabpanel",id:"panel-data","aria-labelledby":"tab-data",children:u.length>0?f("div",{style:{maxHeight:"400px",overflowY:"auto"},children:f("table",{style:{width:"100%",textAlign:"left",borderCollapse:"collapse",fontSize:"0.9rem"},children:[f("thead",{children:f("tr",{style:{background:"#eee",borderBottom:"2px solid #ddd"},children:[Array.isArray(k.inputLabels)?k.inputLabels.map((y,z)=>f("th",{style:{padding:"8px"},children:y},z)):f("th",{style:{padding:"8px"},children:["Input (",k.inputLabel,")"]}),f("th",{style:{padding:"8px"},children:"Target"}),f("th",{style:{padding:"8px"},children:"E-Mail Text"})]})}),f("tbody",{children:u.map((y,z)=>{const w=y.target===1;return f("tr",{style:{background:w?"#ffebee":"#e8f5e9",borderBottom:"1px solid #ddd"},children:[Array.isArray(y.input)?y.input.map((R,H)=>f("td",{style:{padding:"8px"},children:R.toFixed(0)},H)):f("td",{style:{padding:"8px"},children:y.input.toFixed(2)}),f("td",{style:{padding:"8px",fontWeight:"bold",color:w?"#c0392b":"#27ae60"},children:w?"SPAM":"HAM"}),f("td",{style:{padding:"8px",color:"#555",fontStyle:"italic",maxWidth:"300px"},children:y.text||"-"})]},z)})})]})}):f("p",{style:{padding:"20px",textAlign:"center",color:"#666"},children:"Noch keine Trainingsdaten generiert."})}),b==="training"&&f("div",{className:"training-content",role:"tabpanel",id:"panel-training","aria-labelledby":"tab-training",children:g.length>0?f(Pe,{history:g,currentStepIndex:v,isTraining:S,paramsConfig:e.trainingConfig.params}):f("p",{style:{padding:"20px",textAlign:"center",color:"#666"},children:"Noch kein Training gestartet."})})]})}),f("div",{className:"network-wrapper",style:{flex:"0 0 350px"},children:f(We,{input:E,weight:i.current?i.current.weights||i.current.weight:0,bias:i.current?i.current.bias:0,output:i.current?i.current.predict(E):0,formula:k.formula,inputLabel:k.inputLabels||k.inputLabel,outputLabel:k.outputLabel,biasLabel:k.biasLabel})})]}),f(Ce,{onGenerateData:_,onTrain:s,onRun:A,onReset:W,isTraining:S,trainingStep:v,dataCount:u.length,trainerType:x,onTrainerTypeChange:P})]})]})}ve(f(Be,{}),document.getElementById("app"));
